import{r as q,n as P,b as x,j as e,k as d,B as i,S as F,a6 as h,C as D,d as E,e as L,f as R,w as T,g as z,s as B,a5 as p,K,a8 as U,H as Y,a9 as _,W as Q,aa as H,t as f,q as j,u as I,a2 as O}from"./index-vCbmY8Kg.js";import{U as V}from"./user-plus-DrSGHkie.js";import{f as W}from"./format-DercJ5aE.js";import{C as G}from"./chevron-left-BOYwmLJX.js";function J({userId:r,limit:n,showMarkAllAsRead:N=!0,showEmptyState:y=!0,className:v=""}){const[l,m]=q.useState("all"),{data:g,isLoading:w,error:k,refetch:b}=P({queryKey:["/api/notifications",r,l],queryFn:async()=>{const s=`/api/notifications?userId=${r}${l==="unread"?"&unread=true":""}${n?`&limit=${n}`:""}`,a=await fetch(s);if(!a.ok)throw new Error("Failed to fetch notifications");return a.json()},staleTime:6e4,refetchInterval:6e4}),u=x({mutationFn:async s=>{const a=await f("POST",`/api/notifications/${s}/read`);if(!a.ok)throw new Error("Failed to mark notification as read");return a.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/notifications",r]})}}),c=x({mutationFn:async()=>{const s=await f("POST",`/api/notifications/mark-all-read?userId=${r}`);if(!s.ok)throw new Error("Failed to mark all notifications as read");return s.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/notifications",r]})}}),C=(s,a)=>{const t=`h-5 w-5 ${a?"text-gray-400":"text-primary"}`;switch(s){case"friend_request":return e.jsx(V,{className:t});case"message":return e.jsx(Q,{className:t});case"token_received":return e.jsx(_,{className:t});case"badge_earned":return e.jsx(Y,{className:t});case"system_announcement":return e.jsx(U,{className:t});default:return e.jsx(h,{className:t})}},A=s=>{u.mutate(s)},M=()=>{c.mutate()},S=s=>{if(!s)return"";const a=new Date,t=new Date(a);return t.setDate(t.getDate()-1),s>t?H(s,a,{addSuffix:!0}):W(s,"MMM d, yyyy")};if(w)return e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})});if(k)return e.jsxs("div",{className:"text-center p-8 text-red-500",children:[e.jsx("p",{children:"Error loading notifications"}),e.jsx(i,{variant:"outline",className:"mt-4",onClick:()=>b(),children:"Try Again"})]});const o=g||[],$=o.some(s=>!s.readAt);return e.jsxs("div",{className:`notification-center ${v}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground",children:"Your activity and updates"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{variant:l==="all"?"default":"outline",size:"sm",onClick:()=>m("all"),children:"All"}),e.jsx(i,{variant:l==="unread"?"default":"outline",size:"sm",onClick:()=>m("unread"),children:"Unread"}),N&&$&&e.jsxs(i,{variant:"outline",size:"sm",onClick:M,disabled:c.isPending,children:[c.isPending&&e.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Mark all read"]})]})]}),e.jsx(F,{className:"my-4"}),o.length===0?y&&e.jsxs("div",{className:"text-center p-8 border rounded-lg bg-background",children:[e.jsx(h,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"No notifications"}),e.jsx("p",{className:"text-muted-foreground",children:l==="unread"?"You've read all your notifications":"You don't have any notifications yet"})]}):e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsxs(D,{className:`transition-colors ${s.readAt?"":"bg-primary/5 border-primary/10"}`,children:[e.jsx(E,{className:"p-4 pb-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-full ${s.readAt?"bg-muted":"bg-primary/10"}`,children:C(s.type,!!s.readAt)}),e.jsxs("div",{children:[e.jsx(L,{className:"text-base",children:s.title}),e.jsx(R,{className:"text-xs",children:S(s.createdAt)})]})]}),!s.readAt&&e.jsx(T,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20",children:"New"})]})}),e.jsx(z,{className:"p-4 pt-2",children:e.jsx("p",{className:"text-sm",children:s.content})}),e.jsxs(B,{className:"p-4 pt-0 flex justify-between",children:[s.actionLink?e.jsx(i,{asChild:!0,variant:"link",className:"p-0 h-auto text-sm font-normal",children:e.jsx(p,{to:s.actionLink,children:"View Details"})}):e.jsx("span",{}),!s.readAt&&e.jsxs(i,{variant:"ghost",size:"sm",className:"text-xs",onClick:()=>A(s.id),disabled:u.isPending,children:[e.jsx(K,{className:"mr-1 h-3 w-3"}),"Mark as read"]})]})]},s.id))})]})}function ae(){const{user:r,isLoading:n}=I();return!n&&!r?e.jsx(O,{to:"/auth"}):e.jsxs("div",{className:"container max-w-4xl py-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(i,{asChild:!0,variant:"outline",size:"sm",className:"mr-4",children:e.jsxs(p,{to:"/profile",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Back to Profile"]})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Your Notifications"})]}),n?e.jsx("div",{className:"flex justify-center items-center min-h-[300px]",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})}):r&&e.jsx(J,{userId:r.id,showEmptyState:!0})]})}export{ae as default};
