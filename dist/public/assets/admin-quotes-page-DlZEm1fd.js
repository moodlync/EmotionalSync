import{c as K,a as le,m as ie,r as v,n as ce,b as de,aj as oe,aE as xe,j as e,k as Q,aw as U,aF as me,B as u,aY as V,ax as L,ay as E,az as P,aA as z,ak as he,al as i,am as c,an as d,as as o,I as j,ar as x,au as b,aZ as O,a_ as R,a$ as B,b0 as $,b1 as m,X as w,aB as q,b5 as ue,ai as je,C as pe,d as ge,e as ve,f as Ne,g as fe,s as ye,K as G,aD as n,t as H}from"./index-vCbmY8Kg.js";import{A as C}from"./admin-layout-BixmGBh8.js";import"./chart-column-B-07Qafu.js";import"./rotate-ccw-CN_7avtr.js";import"./quote-PLc3nyLZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=K("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=K("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),Ce=n.object({title:n.string().min(1,"Title is required"),description:n.string().min(1,"Description is required"),userId:n.number().optional().nullable(),ticketId:n.number().optional().nullable(),services:n.array(n.object({name:n.string(),description:n.string().optional(),price:n.number().min(0)})).optional(),totalAmount:n.number().min(.01,"Total amount must be greater than 0"),currency:n.string().default("USD"),validUntil:n.string(),notes:n.string().optional(),terms:n.string().optional()});function Fe(){var T;const{toast:k}=le(),Z=ie(),[N,_]=v.useState(""),[p,X]=v.useState(""),[a,D]=v.useState(null),[Y,S]=v.useState(!1),{data:A,isLoading:J,error:f,refetch:W}=ce({queryKey:["/api/admin/quotes"],queryFn:async()=>{const s=await H("GET","/api/admin/quotes");if(!s.ok)throw new Error("Failed to fetch quotes");return s.json()}}),y=de({mutationFn:async s=>{const t=await H("POST","/api/admin/quotes",s);if(!t.ok){const l=await t.json();throw new Error(l.message||"Failed to create quote")}return t.json()},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/admin/quotes"]}),k({title:"Quote created",description:"The quote has been created successfully"}),S(!1)},onError:s=>{k({title:"Creation failed",description:s instanceof Error?s.message:"Failed to create quote",variant:"destructive"})}}),r=oe({resolver:xe(Ce),defaultValues:{title:"",description:"",userId:null,ticketId:null,services:[{name:"",description:"",price:0}],totalAmount:0,currency:"USD",validUntil:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],notes:"",terms:"Payment due within 14 days of acceptance. All services provided are subject to our standard terms and conditions."}}),ee=s=>{var t;!s.totalAmount&&((t=s.services)!=null&&t.length)&&(s.totalAmount=s.services.reduce((l,h)=>l+h.price,0)),y.mutateAsync(s)},se=()=>{const s=r.getValues().services||[];r.setValue("services",[...s,{name:"",description:"",price:0}])},te=s=>{const t=r.getValues().services||[];if(t.length>1){t.splice(s,1),r.setValue("services",[...t]);const l=t.reduce((h,g)=>h+g.price,0);r.setValue("totalAmount",l)}},I=A?A.filter(s=>{const t=p===""||s.title.toLowerCase().includes(p.toLowerCase())||s.description&&s.description.toLowerCase().includes(p.toLowerCase())||s.userId&&s.userId.toString().includes(p)||s.ticketId&&s.ticketId.toString().includes(p),l=N===""||s.status===N;return t&&l}):[],F=s=>{switch(s){case"pending":return"bg-amber-100 text-amber-800";case"accepted":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"expired":return"bg-gray-100 text-gray-800";case"canceled":return"bg-purple-100 text-purple-800";default:return"bg-blue-100 text-blue-800"}};return J?e.jsx(C,{children:e.jsx("div",{className:"flex justify-center items-center h-[80vh]",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"})})}):f?e.jsx(C,{children:e.jsxs("div",{className:"rounded-lg border border-destructive p-4 text-destructive",children:[e.jsx("p",{children:"Error loading quotes"}),e.jsx("p",{className:"text-sm",children:f instanceof Error?f.message:"Unknown error"})]})}):e.jsxs(C,{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Quotes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage price quotes for users and services"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{open:Y,onOpenChange:S,children:[e.jsx(me,{asChild:!0,children:e.jsxs(u,{size:"sm",className:"h-8 gap-1",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Create Quote"})]})}),e.jsxs(L,{className:"max-w-3xl",children:[e.jsxs(E,{children:[e.jsx(P,{children:"Create New Quote"}),e.jsx(z,{children:"Create a quote for services or custom work"})]}),e.jsx(he,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ee),className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"title",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Quote Title"}),e.jsx(o,{children:e.jsx(j,{...s,placeholder:"Custom Premium Features"})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Description"}),e.jsx(o,{children:e.jsx(b,{...s,placeholder:"Detailed description of the quote...",className:"min-h-[120px]"})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"userId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"User ID (Optional)"}),e.jsx(o,{children:e.jsx(j,{type:"number",...s,placeholder:"User ID",value:s.value===null?"":s.value,onChange:t=>{const l=t.target.value===""?null:parseInt(t.target.value);s.onChange(l)}})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:"ticketId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Ticket ID (Optional)"}),e.jsx(o,{children:e.jsx(j,{type:"number",...s,placeholder:"Related ticket",value:s.value===null?"":s.value,onChange:t=>{const l=t.target.value===""?null:parseInt(t.target.value);s.onChange(l)}})}),e.jsx(x,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"validUntil",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Valid Until"}),e.jsx(o,{children:e.jsx(j,{type:"date",...s})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(i,{control:r.control,name:"totalAmount",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Total Amount"}),e.jsx(o,{children:e.jsx(j,{type:"number",...s,onChange:t=>s.onChange(parseFloat(t.target.value))})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:"currency",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Currency"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(R,{children:e.jsx(B,{placeholder:"Currency"})})}),e.jsxs($,{children:[e.jsx(m,{value:"USD",children:"USD"}),e.jsx(m,{value:"EUR",children:"EUR"}),e.jsx(m,{value:"GBP",children:"GBP"}),e.jsx(m,{value:"CAD",children:"CAD"}),e.jsx(m,{value:"AUD",children:"AUD"})]})]}),e.jsx(x,{})]})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Services"}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:se,children:[e.jsx(V,{className:"h-3.5 w-3.5 mr-1"}),"Add Service"]})]}),(T=r.watch("services"))==null?void 0:T.map((s,t)=>{var l;return e.jsxs("div",{className:"space-y-2 rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium",children:["Service #",t+1]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>te(t),disabled:((l=r.watch("services"))==null?void 0:l.length)<=1,children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsx(i,{control:r.control,name:`services.${t}.name`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(d,{children:"Service Name"}),e.jsx(o,{children:e.jsx(j,{...h,placeholder:"e.g., Custom Development"})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:`services.${t}.description`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(d,{children:"Description"}),e.jsx(o,{children:e.jsx(j,{...h,placeholder:"Brief description"})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:`services.${t}.price`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(d,{children:"Price"}),e.jsx(o,{children:e.jsx(j,{type:"number",...h,placeholder:"0.00",onChange:g=>{h.onChange(parseFloat(g.target.value));const M=r.getValues().services||[];M[t].price=parseFloat(g.target.value);const ae=M.reduce((re,ne)=>re+ne.price,0);r.setValue("totalAmount",ae)}})}),e.jsx(x,{})]})})]},t)}),e.jsx(i,{control:r.control,name:"terms",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Terms & Conditions"}),e.jsx(o,{children:e.jsx(b,{...s,className:"min-h-[80px]"})}),e.jsx(x,{})]})}),e.jsx(i,{control:r.control,name:"notes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Additional Notes"}),e.jsx(o,{children:e.jsx(b,{...s,placeholder:"Any additional information...",className:"min-h-[80px]"})}),e.jsx(x,{})]})})]})]}),e.jsx(q,{children:e.jsx(u,{type:"submit",disabled:y.isPending,children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Quote"})})]})})]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>W(),className:"h-8 gap-1",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(j,{type:"search",placeholder:"Search quotes...",className:"pl-8",value:p,onChange:s=>X(s.target.value)})]}),e.jsx("div",{children:e.jsxs(O,{value:N,onValueChange:_,children:[e.jsx(R,{className:"w-[150px]",children:e.jsx(B,{placeholder:"All statuses"})}),e.jsxs($,{children:[e.jsx(m,{value:"",children:"All statuses"}),e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"accepted",children:"Accepted"}),e.jsx(m,{value:"rejected",children:"Rejected"}),e.jsx(m,{value:"expired",children:"Expired"}),e.jsx(m,{value:"canceled",children:"Canceled"})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:I.length>0?I.map(s=>e.jsxs(pe,{className:"overflow-hidden",children:[e.jsxs(ge,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ve,{className:"text-lg",children:s.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${F(s.status)}`,children:s.status})]}),e.jsxs(Ne,{children:[s.userId&&e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:["User #",s.userId]}),s.ticketId&&e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:["Ticket #",s.ticketId]})]})]}),e.jsxs(fe,{className:"pb-2 pt-0",children:[e.jsx("p",{className:"text-sm line-clamp-2 mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium",children:[e.jsx("span",{className:"text-lg",children:s.totalAmount.toFixed(2)})," ",s.currency]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Valid until: ",new Date(s.validUntil).toLocaleDateString()]})]}),s.acceptedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Accepted on: ",new Date(s.acceptedAt).toLocaleDateString()]})]}),e.jsx(ye,{className:"pt-2",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>D(s),children:"View Details"}),s.status==="pending"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:"text-green-600",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Mark Accepted"]}),e.jsxs(u,{variant:"ghost",size:"sm",className:"text-red-600",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]})})]},s.id)):e.jsxs("div",{className:"col-span-full rounded-lg border p-8 text-center text-muted-foreground",children:[e.jsx(we,{className:"mx-auto h-8 w-8 mb-2 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-medium",children:"No quotes found"}),e.jsx("p",{className:"mt-1",children:"Create a new quote to get started"})]})})]}),e.jsx(U,{open:!!a,onOpenChange:s=>!s&&D(null),children:a&&e.jsxs(L,{className:"max-w-3xl",children:[e.jsxs(E,{children:[e.jsxs(P,{children:["Quote #",a.id]}),e.jsxs(z,{children:["Created on ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs ${F(a.status)}`,children:a.status})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[a.totalAmount.toFixed(2)," ",a.currency]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Valid until: ",new Date(a.validUntil).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),a.services&&a.services.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Services"}),e.jsx("div",{className:"rounded-md border divide-y",children:a.services.map((s,t)=>e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"text-right font-medium",children:[s.price.toFixed(2)," ",a.currency]})]})},t))})]}),(a.userId||a.ticketId)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.userId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"User"}),e.jsxs("p",{className:"text-sm",children:["#",a.userId]})]}),a.ticketId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Related Ticket"}),e.jsxs("p",{className:"text-sm",children:["#",a.ticketId]})]})]}),a.terms&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm",children:a.terms})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Additional Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]}),a.acceptedAt&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Accepted On"}),e.jsx("p",{className:"text-sm",children:new Date(a.acceptedAt).toLocaleString()})]})]}),a.status==="pending"&&e.jsxs(q,{className:"gap-2",children:[e.jsxs(u,{variant:"outline",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Cancel Quote"]}),e.jsxs(u,{variant:"default",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Mark as Accepted"]})]})]})})]})}export{Fe as default};
