import{a as L,m as $,r as i,n as q,b as M,j as e,k,B as d,b6 as U,aj as B,I as Q,a_ as K,a$ as O,b0 as z,b1 as H,b2 as c,C as G,d as V,e as X,f as _,g as J,o as W,ax as Y,ay as Z,az as ee,aA as se,aB as te,av as ae,aC as ne,t as p}from"./index-CriQqr38.js";import{A as j}from"./admin-layout-C038jqd_.js";import{C as re}from"./circle-x-Qb4XpLKQ.js";import"./log-out-BF9kSmxu.js";import"./rotate-ccw-BlpTPyoF.js";import"./quote-Bd4aNfLu.js";function xe(){const{toast:f}=L(),g=$(),[r,v]=i.useState(null),[l,A]=i.useState(""),[m,D]=i.useState(""),[N,y]=i.useState(""),[P,o]=i.useState(!1),[n,b]=i.useState(""),{data:w,isLoading:I,error:u,refetch:F}=q({queryKey:["/api/admin/refunds",l],queryFn:async()=>{const s=new URLSearchParams;l&&s.append("status",l);const a=await p("GET",`/api/admin/refunds${s.toString()?`?${s.toString()}`:""}`);if(!a.ok)throw new Error("Failed to fetch refund requests");return a.json()}}),{data:t,isLoading:ie}=q({queryKey:["/api/admin/refunds",r],queryFn:async()=>{if(!r)return null;const s=await p("GET",`/api/admin/refunds/${r}`);if(!s.ok)throw new Error("Failed to fetch refund details");return s.json()},enabled:!!r}),x=M({mutationFn:async({refundId:s,status:a,notes:E})=>{const S=await p("PATCH",`/api/admin/refunds/${s}`,{status:a,notes:E});if(!S.ok)throw new Error("Failed to update refund request");return S.json()},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/admin/refunds"]}),g.invalidateQueries({queryKey:["/api/admin/refunds",r]}),f({title:"Refund request updated",description:"The refund request has been updated successfully"}),o(!1),y(""),b("")},onError:s=>{f({title:"Update failed",description:s instanceof Error?s.message:"Failed to update refund request",variant:"destructive"})}}),C=w?w.filter(s=>{if(m==="")return!0;const a=m.toLowerCase();return s.reason.toLowerCase().includes(a)||s.id.toString().includes(a)||s.userId.toString().includes(a)||s.transactionId&&s.transactionId.toLowerCase().includes(a)}):[],h=(s,a)=>{v(s),b(a),o(!0)},T=async()=>{const s=n==="approve"?"approved":n==="reject"?"rejected":n==="process"?"processed":"pending";await x.mutateAsync({refundId:r,status:s,notes:N})},R=s=>{switch(s){case"pending":return"bg-amber-100 text-amber-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"processed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return I?e.jsx(j,{children:e.jsx("div",{className:"flex justify-center items-center h-[80vh]",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})})}):u?e.jsx(j,{children:e.jsxs("div",{className:"rounded-lg border border-destructive p-4 text-destructive",children:[e.jsx("p",{children:"Error loading refund requests"}),e.jsx("p",{className:"text-sm",children:u instanceof Error?u.message:"Unknown error"})]})}):e.jsxs(j,{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Refund Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage refund requests from users"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>F(),className:"h-8 gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{type:"search",placeholder:"Search refunds...",className:"pl-8",value:m,onChange:s=>D(s.target.value)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(K,{value:l,onValueChange:A,children:[e.jsx(O,{className:"w-[140px]",children:e.jsx(z,{placeholder:"All statuses"})}),e.jsxs(H,{children:[e.jsx(c,{value:"",children:"All statuses"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"approved",children:"Approved"}),e.jsx(c,{value:"rejected",children:"Rejected"}),e.jsx(c,{value:"processed",children:"Processed"})]})]})})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-muted/50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"flex gap-4",children:e.jsx("span",{className:"font-medium",children:"Refund Details"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("span",{className:"font-medium text-right",children:"Amount"}),e.jsx("span",{className:"font-medium hidden md:block",children:"Status"}),e.jsx("span",{className:"font-medium hidden md:block",children:"Date"})]})]})}),e.jsx("div",{className:"divide-y",children:C.length>0?C.map(s=>e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-muted/50",onClick:()=>v(s.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:["Request #",s.id]}),e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:s.reason}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["User ID: #",s.userId]}),s.transactionId&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Transaction: ",s.transactionId]})]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("span",{className:"font-medium whitespace-nowrap",children:["$",parseFloat(s.amount).toFixed(2)," ",s.currency]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${R(s.status)} hidden md:inline-block`,children:s.status}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap hidden md:block",children:new Date(s.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},s.id)):e.jsx("div",{className:"px-4 py-8 text-center text-muted-foreground",children:"No refund requests found"})})]})]}),r&&t&&e.jsx("div",{className:"w-full md:w-[400px]",children:e.jsxs(G,{className:"sticky top-6",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(X,{children:["Refund Request #",t.id]}),e.jsxs(_,{children:["User ID: #",t.userId]})]}),e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${R(t.status)}`,children:t.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Reason"}),e.jsx("p",{className:"text-sm",children:t.reason})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold",children:["$",parseFloat(t.amount).toFixed(2)," ",t.currency]})]}),t.transactionId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Transaction ID"}),e.jsx("p",{className:"text-sm",children:t.transactionId})]}),t.paymentMethod&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Payment Method"}),e.jsx("p",{className:"text-sm capitalize",children:t.paymentMethod})]}),t.ticketId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Related Ticket"}),e.jsxs("p",{className:"text-sm",children:["#",t.ticketId]})]}),t.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm",children:t.notes})]}),t.evidence&&t.evidence.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Evidence"}),e.jsx("ul",{className:"text-sm list-disc pl-5",children:t.evidence.map((s,a)=>e.jsx("li",{children:s},a))})]}),t.processedBy&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Processed By"}),e.jsxs("p",{className:"text-sm",children:["Admin #",t.processedBy]})]}),t.processedAt&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Processed On"}),e.jsx("p",{className:"text-sm",children:new Date(t.processedAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),t.status==="pending"&&e.jsx("div",{className:"pt-2 flex flex-col gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(d,{variant:"outline",className:"w-full",onClick:()=>h(t.id,"approve"),children:[e.jsx(W,{className:"mr-2 h-4 w-4 text-green-500"}),"Approve"]}),e.jsxs(d,{variant:"outline",className:"w-full",onClick:()=>h(t.id,"reject"),children:[e.jsx(re,{className:"mr-2 h-4 w-4 text-red-500"}),"Reject"]})]})}),t.status==="approved"&&e.jsx("div",{className:"pt-2",children:e.jsx(d,{className:"w-full",onClick:()=>h(t.id,"process"),children:"Mark as Processed"})})]})]})})]})]}),e.jsx(Y,{open:P,onOpenChange:o,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:n==="approve"?"Approve Refund Request":n==="reject"?"Reject Refund Request":"Process Refund"}),e.jsx(te,{children:n==="approve"?"The user will be notified that their refund request has been approved.":n==="reject"?"The user will be notified that their refund request has been rejected.":"This will mark the refund as processed in the system."})]}),e.jsx("div",{className:"space-y-4 py-2",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Add Processing Notes"}),e.jsx(ae,{placeholder:"Add any notes or comments about this decision...",value:N,onChange:s=>y(s.target.value),className:"min-h-[100px]"})]})}),e.jsxs(ne,{children:[e.jsx(d,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(d,{onClick:T,disabled:x.isPending,variant:n==="reject"?"destructive":"default",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):n==="approve"?"Approve Request":n==="reject"?"Reject Request":"Mark as Processed"})]})]})})]})}export{xe as default};
