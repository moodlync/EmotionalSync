import{a as C,W as v,r as j,Y as T,b as f,j as e,B as g,C as E,d as M,e as S,f as A,g as P,a0 as F,o,aT as R,a2 as D,Q as I,V as l}from"./index-FJB1i4HR.js";import{A as H}from"./admin-layout-8bamUuof.js";import{T as L,a as q,b as c,c as n,d as z,e as i}from"./table-1Ol1_18p.js";import{R as y}from"./rotate-ccw-DBn94ek4.js";import{D as G}from"./database-rNbYySWX.js";import{D as O}from"./download-L8JcrHkQ.js";import{C as Q}from"./circle-x-DEI79z4-.js";import{f as w}from"./format-unr8vqsB.js";import"./log-out-BnUgBTG3.js";import"./quote-B2rQvQyw.js";function ee(){var x;const{toast:r}=C(),N=v(),[m,u]=j.useState(!1),{data:a,isLoading:b}=T({queryKey:["/api/admin/system/backups"],queryFn:async()=>{const s=await l("GET","/api/admin/system/backups");if(!s.ok)throw new Error("Failed to fetch backups");return await s.json()}});j.useEffect(()=>{if(a!=null&&a.data){const s=a.data.find(t=>t.status==="IN_PROGRESS");u(!!s)}},[a]);const d=f({mutationFn:async()=>{const s=await l("POST","/api/admin/system/backup");if(!s.ok)throw new Error("Failed to initiate backup");return await s.json()},onSuccess:()=>{r({title:"Backup initiated",description:"System backup has been started and will be available shortly."}),u(!0),setTimeout(()=>{N.invalidateQueries({queryKey:["/api/admin/system/backups"]})},500)},onError:s=>{r({title:"Backup failed",description:s instanceof Error?s.message:"Failed to initiate backup",variant:"destructive"})}}),h=f({mutationFn:async s=>{const t=await l("GET",`/api/admin/system/backups/${s}/download`);if(!t.ok)throw new Error("Failed to get download URL");return await t.json()},onSuccess:s=>{r({title:"Download started",description:"Your backup file download has started."})},onError:s=>{r({title:"Download failed",description:s instanceof Error?s.message:"Failed to get download URL",variant:"destructive"})}}),k=s=>{switch(s){case"COMPLETED":return e.jsxs(o,{className:"bg-green-500 hover:bg-green-600",children:[e.jsx(I,{className:"h-3 w-3 mr-1"})," Completed"]});case"IN_PROGRESS":return e.jsxs(o,{className:"bg-blue-500 hover:bg-blue-600",children:[e.jsx(D,{className:"h-3 w-3 mr-1"})," In Progress"]});case"FAILED":return e.jsxs(o,{className:"bg-red-500 hover:bg-red-600",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"})," Failed"]});default:return e.jsxs(o,{variant:"outline",children:[e.jsx(R,{className:"h-3 w-3 mr-1"})," ",s]})}},B=s=>{if(s===null)return"N/A";const t=["Bytes","KB","MB","GB","TB"];if(s===0)return"0 Byte";const p=Math.floor(Math.log(s)/Math.log(1024));return Math.round(s/Math.pow(1024,p)*100)/100+" "+t[p]};return e.jsx(H,{children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Backup"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage system backups and data recovery"})]}),e.jsxs(g,{onClick:()=>d.mutate(),disabled:m||d.isPending,className:"gap-2",children:[d.isPending?e.jsx(y,{className:"h-4 w-4 animate-spin"}):e.jsx(G,{className:"h-4 w-4"}),m?"Backup in progress...":d.isPending?"Starting backup...":"Create Backup"]})]}),e.jsx("div",{className:"mt-6 grid gap-6",children:e.jsxs(E,{children:[e.jsxs(M,{children:[e.jsx(S,{children:"Backup History"}),e.jsx(A,{children:"Recent system backups and their status"})]}),e.jsx(P,{children:b?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(L,{children:[e.jsx(q,{children:e.jsxs(c,{children:[e.jsx(n,{children:"Backup ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Initiated At"}),e.jsx(n,{children:"Completed At"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Size"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(z,{children:a!=null&&a.data&&a.data.length>0?a.data.map((s,t)=>e.jsxs(c,{children:[e.jsx(i,{className:"font-medium",children:s.backupId}),e.jsx(i,{children:s.backupType}),e.jsx(i,{children:s.initiatedAt?w(new Date(s.initiatedAt),"MMM dd, yyyy HH:mm:ss"):"N/A"}),e.jsx(i,{children:s.completedAt?w(new Date(s.completedAt),"MMM dd, yyyy HH:mm:ss"):"â€”"}),e.jsx(i,{children:k(s.status)}),e.jsx(i,{children:B(s.fileSize)}),e.jsx(i,{children:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>h.mutate(s.backupId),disabled:s.status!=="COMPLETED"||h.isPending,children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Download"]})})]},s.id||t)):e.jsx(c,{children:e.jsx(i,{colSpan:7,className:"text-center py-6",children:"No backups found"})})})]})})}),e.jsxs(F,{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Note:"})," Backups are retained for 30 days by default."]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",((x=a==null?void 0:a.data)==null?void 0:x.length)||0," backups"]})]})]})})]})})}export{ee as default};
