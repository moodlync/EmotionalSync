import{c as z,u as J,a as ge,r as u,Y as C,V as y,b as w,j as e,k,C as N,d as T,e as E,g as v,a0 as Ke,B as o,a4 as Ce,a5 as Te,a6 as V,a7 as Y,o as F,at as Ge,a2 as Je,Q as Qe,X as be,ap as he,aT as ue,f as I,L as H,ag as Be,bl as Xe,S as K,I as je,U as G,G as Me,H as Se,J as Ae,K as Pe,M as P,l as _e,af as fe,F as Ze,av as pe,w as Z,x as ee,v as se,y as ae,z as te,D as re,E as es,R as $,t as ss,q as we,N as as,$ as ts,_ as rs,bE as ns,as as is,ar as ls}from"./index-FJB1i4HR.js";import{A as Ee,a as Re,b as Ue}from"./alert-DPSoV0TE.js";import{A as ne,b as ie,c as le,d as ce,e as oe,f as de,g as me,h as ke,B as cs}from"./alert-dialog-ClcxSCe0.js";import{U as D}from"./user-plus-zORz52E-.js";import{L as os}from"./link-2dqR529y.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=z("SendHorizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=z("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=z("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=z("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=z("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);function xs(){J();const{toast:n}=ge(),[m,x]=u.useState("members"),[r,j]=u.useState(""),[c,M]=u.useState(null),[i,R]=u.useState("other"),[U,f]=u.useState(!1),[p,b]=u.useState(!1),[t,l]=u.useState(null),[S,a]=u.useState(!1),[d,A]=u.useState(""),{data:L,isLoading:Le,error:Ie,refetch:W}=C({queryKey:["/api/family-members"],refetchOnWindowFocus:!1}),{data:ye,isLoading:De}=C({queryKey:["/api/premium/plan"],refetchOnWindowFocus:!1}),{data:Q,isLoading:B,error:js}=C({queryKey:["/api/users/search",r],enabled:r.length>=2,queryFn:async()=>{const s=await y("GET",`/api/users/search?q=${encodeURIComponent(r)}`);if(!s.ok)throw new Error("Failed to search users");return s.json()}}),X=w({mutationFn:async s=>{const h=await y("POST","/api/family-members",s);if(!h.ok){const g=await h.json();throw new Error(g.message||"Failed to add family member")}return h.json()},onSuccess:()=>{n({title:"Member Added",description:"Family member has been invited. They will need to accept your invitation.",variant:"default"}),W(),f(!1),M(null),R("other")},onError:s=>{n({title:"Failed to Add Member",description:s.message,variant:"destructive"})}}),_=w({mutationFn:async s=>{const h=await y("DELETE",`/api/family-members/${s}`);if(!h.ok){const g=await h.json();throw new Error(g.message||"Failed to remove family member")}return h.json()},onSuccess:()=>{n({title:"Member Removed",description:"Family member has been removed successfully.",variant:"default"}),W(),b(!1),l(null)},onError:s=>{n({title:"Failed to Remove Member",description:s.message,variant:"destructive"})}}),Ve=w({mutationFn:async({id:s,data:h})=>{const g=await y("PATCH",`/api/family-members/${s}`,h);if(!g.ok){const He=await g.json();throw new Error(He.message||"Failed to update permissions")}return g.json()},onSuccess:()=>{n({title:"Permissions Updated",description:"Family member permissions have been updated successfully.",variant:"default"}),W()},onError:s=>{n({title:"Failed to Update Permissions",description:s.message,variant:"destructive"})}}),Ye=w({mutationFn:async()=>{const s=await y("GET","/api/referrals/link");if(!s.ok){const h=await s.json();throw new Error(h.message||"Failed to get referral link")}return s.json()},onSuccess:s=>{A(s.link),a(!0)},onError:s=>{n({title:"Failed to Get Referral Link",description:s.message,variant:"destructive"})}}),Oe=s=>{j(s.target.value)},ze=s=>{M(s),j("")},We=()=>{c&&X.mutate({relatedUserId:c.id,relationshipType:i,canViewMood:!1,canViewJournal:!1,canReceiveAlerts:!1,canTransferTokens:!0})},Ne=s=>{l(s),b(!0)},ve=(s,h,g)=>{Ve.mutate({id:s.id,data:{[h]:g}})},$e=()=>{Ye.mutate()},qe=()=>{navigator.clipboard.writeText(d),n({title:"Link Copied",description:"Referral link has been copied to clipboard.",variant:"default"})};return Le||De?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):Ie?e.jsxs(N,{children:[e.jsx(T,{children:e.jsx(E,{className:"text-destructive",children:"Error"})}),e.jsx(v,{children:e.jsx("p",{children:"Failed to load family members. Please try again later."})}),e.jsx(Ke,{children:e.jsx(o,{onClick:()=>W(),children:"Retry"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{defaultValue:m,onValueChange:x,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(V,{value:"members",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Family Members"]}),e.jsxs(V,{value:"invite",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Invite Family"]})]}),e.jsxs(Y,{value:"members",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Your Family Members"}),ye&&e.jsxs(F,{variant:"outline",className:"bg-primary/10",children:[(L==null?void 0:L.length)||0," / ",ye.memberLimit," Members"]})]}),!L||L.length===0?e.jsx(N,{className:"border-dashed",children:e.jsxs(v,{className:"pt-6 flex flex-col items-center justify-center text-center",children:[e.jsx(Ge,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Family Members Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add your first family member by inviting them to join your plan."}),e.jsxs(o,{onClick:()=>x("invite"),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Invite Family"]})]})}):e.jsx("div",{className:"space-y-4",children:L.map(s=>e.jsxs(N,{className:"overflow-hidden",children:[e.jsxs(T,{className:"p-4 pb-0 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[s.relatedUser.profilePicture?e.jsx("img",{src:s.relatedUser.profilePicture,alt:s.relatedUser.username,className:"h-10 w-10 rounded-full mr-3 object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center mr-3",children:e.jsx(q,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.relatedUser.username}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:s.relationshipType})]})]}),e.jsx("div",{className:"flex items-center",children:s.status==="pending"?e.jsxs(F,{variant:"outline",className:"bg-amber-50 text-amber-600 border-amber-200",children:[e.jsx(Je,{className:"mr-1 h-3 w-3"}),"Pending"]}):s.status==="accepted"?e.jsxs(F,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:[e.jsx(Qe,{className:"mr-1 h-3 w-3"}),"Connected"]}):e.jsxs(F,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:[e.jsx(be,{className:"mr-1 h-3 w-3"}),"Declined"]})})]}),e.jsxs(v,{className:"p-4",children:[s.status==="accepted"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"h-8 w-8 rounded bg-muted flex items-center justify-center mr-2",children:e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Mood Tracking"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.canViewMood?"Allowed":"Not allowed"})]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"h-8 w-8 rounded bg-muted flex items-center justify-center mr-2",children:e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Journal Access"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.canViewJournal?"Allowed":"Not allowed"})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ne(s),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Remove"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ve(s,"canTransferTokens",!s.canTransferTokens),children:[s.canTransferTokens?"Disable":"Enable"," Token Transfer"]}),e.jsxs(o,{variant:s.canViewMood?"default":"outline",size:"sm",onClick:()=>ve(s,"canViewMood",!s.canViewMood),children:[s.canViewMood?"Disable":"Enable"," Mood Tracking"]})]})]})]}),s.status==="pending"&&e.jsx("div",{className:"bg-amber-50 p-3 rounded-lg text-sm text-amber-800",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ue,{className:"h-5 w-5 mr-2 flex-shrink-0"}),e.jsxs("p",{children:["Waiting for ",s.relatedUser.username," to accept your invitation. They'll need to log in and approve this connection."]})]})}),s.status==="rejected"&&e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg text-sm text-red-800",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(ue,{className:"h-5 w-5 mr-2 flex-shrink-0"}),e.jsxs("p",{children:[s.relatedUser.username," has declined your invitation. You can remove this connection and try again later."]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ne(s),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Remove Connection"]})})]})]})]},s.id))})]}),e.jsx(Y,{value:"invite",className:"space-y-4 pt-4",children:e.jsxs(N,{children:[e.jsxs(T,{children:[e.jsx(E,{children:"Add Family Members"}),e.jsx(I,{children:"Invite your family members to join your premium family plan"})]}),e.jsx(v,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"share-link",children:"1. Share Your Referral Link"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1.5",children:[e.jsxs(o,{onClick:$e,className:"flex-1",variant:"outline",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Get Referral Link"]}),e.jsx(o,{variant:"outline",children:e.jsx(Xe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Share this link with your family members so they can create an account"})]}),e.jsx(K,{}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"search-username",children:"2. Find Family Member by Username"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1.5",children:[e.jsx(je,{id:"search-username",placeholder:"Enter username to search",value:r,onChange:Oe}),e.jsx(o,{variant:"outline",disabled:r.length<2||B,children:B?e.jsx(k,{className:"h-4 w-4 animate-spin"}):e.jsx(G,{className:"h-4 w-4"})})]}),r.length>=2&&!B&&Q&&e.jsx("div",{className:"mt-2 border rounded-md max-h-60 overflow-y-auto",children:Q.length===0?e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground",children:['No users found matching "',r,'"']}):e.jsx("ul",{className:"divide-y",children:Q.map(s=>e.jsx("li",{className:"p-2 hover:bg-muted/50 cursor-pointer",children:e.jsxs("button",{className:"w-full flex items-center text-left",onClick:()=>ze(s),children:[s.profilePicture?e.jsx("img",{src:s.profilePicture,alt:s.username,className:"h-8 w-8 rounded-full mr-2 object-cover"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-muted flex items-center justify-center mr-2",children:e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.username}),(s.firstName||s.lastName)&&e.jsx("div",{className:"text-xs text-muted-foreground",children:[s.firstName,s.lastName].filter(Boolean).join(" ")})]})]})},s.id))})})]}),c&&e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[c.profilePicture?e.jsx("img",{src:c.profilePicture,alt:c.username,className:"h-10 w-10 rounded-full mr-3 object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center mr-3",children:e.jsx(q,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:c.username}),(c.firstName||c.lastName)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:[c.firstName,c.lastName].filter(Boolean).join(" ")})]})]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>M(null),children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"relationship-type",children:"3. Relationship Type"}),e.jsxs(Me,{value:i,onValueChange:R,children:[e.jsx(Se,{className:"w-full mt-1.5",children:e.jsx(Ae,{placeholder:"Select relationship"})}),e.jsxs(Pe,{children:[e.jsx(P,{value:"parent",children:"Parent"}),e.jsx(P,{value:"child",children:"Child"}),e.jsx(P,{value:"spouse",children:"Spouse"}),e.jsx(P,{value:"sibling",children:"Sibling"}),e.jsx(P,{value:"grandparent",children:"Grandparent"}),e.jsx(P,{value:"other",children:"Other Family"})]})]})]}),e.jsxs(o,{onClick:()=>f(!0),className:"w-full",disabled:!i,children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Add Family Member"]})]})]})]})})]})})]}),e.jsx(ne,{open:U,onOpenChange:f,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Add Family Member"}),e.jsx(oe,{children:c&&e.jsxs(e.Fragment,{children:["You're about to send an invitation to ",e.jsx("strong",{children:c.username})," to join your family plan. They will need to accept your invitation before they can be added to your plan."]})})]}),e.jsxs(de,{children:[e.jsx(me,{children:"Cancel"}),e.jsxs(ke,{onClick:We,disabled:X.isPending,children:[X.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(D,{className:"mr-2 h-4 w-4"}),"Send Invitation"]})]})]})}),e.jsx(ne,{open:p,onOpenChange:b,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Remove Family Member"}),e.jsx(oe,{children:t&&e.jsxs(e.Fragment,{children:["Are you sure you want to remove ",e.jsx("strong",{children:t.relatedUser.username})," from your family plan? This action cannot be undone."]})})]}),e.jsxs(de,{children:[e.jsx(me,{children:"Cancel"}),e.jsxs(ke,{onClick:()=>t&&_.mutate(t.id),disabled:_.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[_.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Remove Member"]})]})]})}),e.jsx(ne,{open:S,onOpenChange:a,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Share Your Referral Link"}),e.jsx(oe,{children:"Share this link with your family members so they can create an account and join your plan."})]}),e.jsxs("div",{className:"flex items-center space-x-2 my-4",children:[e.jsx(je,{value:d,readOnly:!0}),e.jsx(o,{variant:"outline",size:"icon",onClick:qe,children:e.jsx(os,{className:"h-4 w-4"})})]}),e.jsx(de,{children:e.jsx(me,{children:"Close"})})]})})]})}const hs=$.object({recipientId:$.string().min(1,{message:"Please select a recipient"}),amount:$.string().refine(n=>!isNaN(Number(n)),{message:"Amount must be a number"}).refine(n=>Number(n)>0,{message:"Amount must be greater than 0"}).refine(n=>Number(n)===Math.floor(Number(n)),{message:"Amount must be a whole number"}),notes:$.string().max(100).optional()});function us(){J();const{toast:n}=ge(),[m,x]=u.useState(null),r=_e({resolver:ss(hs),defaultValues:{recipientId:"",amount:"",notes:""}}),{data:j,isLoading:c,error:M}=C({queryKey:["/api/family-members"],refetchOnWindowFocus:!1}),{data:i,isLoading:R}=C({queryKey:["/api/tokens"],refetchOnWindowFocus:!1}),U=(j==null?void 0:j.filter(t=>t.status==="accepted"&&t.canTransferTokens))||[],f=t=>{const l=U.find(S=>S.relatedUserId.toString()===t);x(l||null)},p=w({mutationFn:async t=>{const l=await y("POST","/api/tokens/transfer",{recipientId:Number(t.recipientId),amount:Number(t.amount),notes:t.notes||void 0,type:"family"});if(!l.ok){const S=await l.json();throw new Error(S.message||"Failed to transfer tokens")}return l.json()},onSuccess:()=>{n({title:"Tokens Transferred",description:`You've successfully transferred ${r.getValues().amount} tokens to ${m==null?void 0:m.relatedUser.username}.`,variant:"default"}),r.reset(),x(null),we.invalidateQueries({queryKey:["/api/tokens"]}),we.invalidateQueries({queryKey:["/api/rewards/history"]})},onError:t=>{n({title:"Transfer Failed",description:t.message||"Failed to transfer tokens. Please try again.",variant:"destructive"})}});function b(t){p.mutate(t)}return c||R?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(N,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center",children:[e.jsx(fe,{className:"mr-2 h-5 w-5 text-primary"}),"Family Token Transfer"]}),e.jsx(I,{children:"Transfer tokens to your family members for redemption"})]}),e.jsx(v,{children:U.length===0?e.jsxs("div",{className:"bg-muted p-6 rounded-lg text-center space-y-4",children:[e.jsx(cs,{className:"h-12 w-12 text-muted-foreground mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium text-lg",children:"No Eligible Recipients"}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-md mx-auto",children:!j||j.length===0?"You don't have any family members yet. Add family members to your plan first.":j.every(t=>t.status!=="accepted")?"Your family members need to accept your invitation before you can transfer tokens.":"You need to enable token transfers for your family members in the family management page."})]})]}):e.jsx(Ze,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(b),className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 text-primary mr-2"}),e.jsx("span",{className:"font-medium",children:"Current Token Balance:"})]}),e.jsx("span",{className:"text-xl font-bold",children:(i==null?void 0:i.tokens)||0})]}),e.jsx(Z,{control:r.control,name:"recipientId",render:({field:t})=>e.jsxs(ee,{children:[e.jsx(se,{children:"Recipient"}),e.jsxs(Me,{onValueChange:l=>{t.onChange(l),f(l)},defaultValue:t.value,children:[e.jsx(ae,{children:e.jsx(Se,{children:e.jsx(Ae,{placeholder:"Select family member"})})}),e.jsx(Pe,{children:U.map(l=>e.jsx(P,{value:l.relatedUserId.toString(),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ms,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx("span",{children:l.relatedUser.username})]})},l.relatedUserId))})]}),m&&e.jsxs(te,{children:[m.relatedUser.username," currently has ",m.relatedUser.emotionTokens," tokens"]}),e.jsx(re,{})]})}),e.jsx(Z,{control:r.control,name:"amount",render:({field:t})=>e.jsxs(ee,{children:[e.jsx(se,{children:"Amount"}),e.jsx(ae,{children:e.jsx(je,{type:"number",placeholder:"Enter token amount",min:"1",step:"1",...t})}),e.jsxs(te,{children:["Only whole numbers allowed. Maximum: ",(i==null?void 0:i.tokens)||0," tokens"]}),e.jsx(re,{})]})}),e.jsx(Z,{control:r.control,name:"notes",render:({field:t})=>e.jsxs(ee,{children:[e.jsx(se,{children:"Notes (Optional)"}),e.jsx(ae,{children:e.jsx(es,{placeholder:"Add a note to the recipient",className:"resize-none",...t})}),e.jsx(te,{children:"Add a personal message (max 100 characters)"}),e.jsx(re,{})]})}),Number(r.watch("amount"))>((i==null?void 0:i.tokens)||0)&&e.jsxs("div",{className:"flex items-start space-x-2 text-destructive text-sm",children:[e.jsx(ue,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:["You don't have enough tokens for this transfer. Maximum available: ",(i==null?void 0:i.tokens)||0]})]}),e.jsxs(o,{type:"submit",className:"w-full",disabled:p.isPending||!r.watch("recipientId")||!r.watch("amount")||Number(r.watch("amount"))>((i==null?void 0:i.tokens)||0),children:[p.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Transfer Tokens"]})]})})})]})}function Fe(){J();const{toast:n}=ge(),[m,x]=u.useState({allowMoodTracking:!1}),{data:r,isLoading:j,error:c,refetch:M}=C({queryKey:["/api/family-requests"],refetchOnWindowFocus:!1}),{data:i,isLoading:R,error:U}=C({queryKey:["/api/user/consent-settings"],refetchOnWindowFocus:!1});u.useEffect(()=>{i&&x(i)},[i]);const f=(r==null?void 0:r.filter(a=>a.status==="pending"))||[],p=(r==null?void 0:r.filter(a=>a.status==="accepted"))||[],b=w({mutationFn:async a=>{const d=await y("PATCH",`/api/family-members/${a}/status`,{status:"accepted"});if(!d.ok){const A=await d.json();throw new Error(A.message||"Failed to accept invitation")}return d.json()},onSuccess:()=>{n({title:"Invitation Accepted",description:"You are now connected to your family member.",variant:"default"}),M()},onError:a=>{n({title:"Failed to Accept Invitation",description:a.message,variant:"destructive"})}}),t=w({mutationFn:async a=>{const d=await y("PATCH",`/api/family-members/${a}/status`,{status:"rejected"});if(!d.ok){const A=await d.json();throw new Error(A.message||"Failed to reject invitation")}return d.json()},onSuccess:()=>{n({title:"Invitation Rejected",description:"You have declined the family connection request.",variant:"default"}),M()},onError:a=>{n({title:"Failed to Reject Invitation",description:a.message,variant:"destructive"})}}),l=w({mutationFn:async a=>{const d=await y("PATCH","/api/mood-tracking-consent",a);if(!d.ok){const A=await d.json();throw new Error(A.message||"Failed to update consent settings")}return d.json()},onSuccess:a=>{n({title:"Consent Settings Updated",description:"Your mood tracking consent settings have been updated.",variant:"default"}),x(a)},onError:a=>{n({title:"Failed to Update Settings",description:a.message,variant:"destructive"})}}),S=a=>{l.mutate({allowMoodTracking:a})};return j||R?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center",children:[e.jsx(he,{className:"h-5 w-5 mr-2 text-primary"}),"Mood Tracking Consent"]}),e.jsx(I,{children:"Control if family members can view your emotional health data"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{id:"mood-tracking",checked:m.allowMoodTracking,onCheckedChange:S,disabled:l.isPending}),e.jsx(H,{htmlFor:"mood-tracking",className:"font-medium",children:"Allow Family Members to Track My Mood"})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-12",children:"When enabled, family members with permission can view your emotional status and mood history."})]}),e.jsx("div",{className:"bg-muted p-4 rounded-lg flex items-start space-x-3",children:m.allowMoodTracking?e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-700 dark:text-green-400",children:"Sharing Enabled"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Family members with permission can see your emotional health data. You can revoke this at any time."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-5 w-5 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-700 dark:text-amber-400",children:"Sharing Disabled"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your mood data is private. No family members can see your emotional health information."})]})]})})]})})]}),f.length>0&&e.jsxs(N,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center",children:[e.jsx(O,{className:"h-5 w-5 mr-2 text-amber-500"}),"Pending Family Requests"]}),e.jsx(I,{children:"These people want to connect with you as family members"})]}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:f.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[a.owner.profilePicture?e.jsx("img",{src:a.owner.profilePicture,alt:a.owner.username,className:"h-10 w-10 rounded-full mr-3 object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center mr-3",children:e.jsx(G,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.owner.username}),e.jsxs("p",{className:"text-sm text-muted-foreground capitalize",children:["Wants to connect as: ",a.relationshipType]})]})]}),e.jsx(F,{variant:"outline",className:"bg-amber-50 text-amber-600 border-amber-200",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg text-center flex flex-col items-center",children:[e.jsx(ns,{className:"h-5 w-5 text-rose-500 mb-1"}),e.jsx("h5",{className:"text-sm font-medium",children:"Mood Tracking"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.canViewMood?"Will be able to view":"Won't be able to view"})]}),e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg text-center flex flex-col items-center",children:[e.jsx(is,{className:"h-5 w-5 text-blue-500 mb-1"}),e.jsx("h5",{className:"text-sm font-medium",children:"Crisis Alerts"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.canReceiveAlerts?"Will receive alerts":"Won't receive alerts"})]})]}),e.jsxs("div",{className:"flex space-x-2 justify-end",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>t.mutate(a.id),disabled:t.isPending,children:"Decline"}),e.jsx(o,{size:"sm",onClick:()=>b.mutate(a.id),disabled:b.isPending,children:"Accept"})]})]},a.id))})})]}),p.length>0&&e.jsxs(N,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center",children:[e.jsx(G,{className:"h-5 w-5 mr-2 text-primary"}),"Connected Family Members"]}),e.jsx(I,{children:"These are your active family connections and their permissions"})]}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:p.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[a.owner.profilePicture?e.jsx("img",{src:a.owner.profilePicture,alt:a.owner.username,className:"h-10 w-10 rounded-full mr-3 object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center mr-3",children:e.jsx(G,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.owner.username}),e.jsxs("p",{className:"text-sm text-muted-foreground capitalize",children:["Connected as: ",a.relationshipType]})]})]}),e.jsx(F,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Connected"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${a.canViewMood?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:"Mood Tracking"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${a.canViewJournal?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:"Journal Access"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${a.canReceiveAlerts?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:"Crisis Alerts"})]})]})]},a.id))})})]}),f.length===0&&p.length===0&&e.jsxs(Ee,{variant:"default",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(Re,{children:"No Family Connections"}),e.jsx(Ue,{children:"You don't have any family members connected to your account. Family members need to invite you to join their family plan first."})]})]})}function vs(){J();const[n,m]=u.useState("members"),{data:x,isLoading:r,error:j}=C({queryKey:["/api/family-plan/status"],refetchOnWindowFocus:!1});return r?e.jsx("div",{className:"container max-w-6xl py-12 flex items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):!x||!x.isPlanOwner&&!x.familyPlanOwnerId?e.jsxs("div",{className:"container max-w-6xl py-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Family Plan"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Connect with your family for shared emotional wellness"})]}),e.jsx(K,{}),e.jsxs(N,{className:"border-dashed",children:[e.jsxs(T,{className:"text-center",children:[e.jsx(E,{className:"text-2xl",children:"Family Plan Required"}),e.jsx(I,{children:"You need to upgrade to a family plan to access these features"})]}),e.jsxs(v,{className:"flex flex-col items-center space-y-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(fe,{className:"h-12 w-12 text-primary"})}),e.jsxs("div",{className:"text-center max-w-md space-y-2",children:[e.jsx("h3",{className:"text-xl font-medium",children:"Family Wellness Features"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect with family members, monitor their emotional wellbeing (with consent), and share tokens for redemption."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-2xl",children:[e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg text-center",children:[e.jsx(O,{className:"h-8 w-8 mx-auto mb-2 text-amber-500"}),e.jsx("h4",{className:"font-medium",children:"Consent-Based Tracking"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor loved ones' moods with their explicit permission"})]}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg text-center",children:[e.jsx(pe,{className:"h-8 w-8 mx-auto mb-2 text-emerald-500"}),e.jsx("h4",{className:"font-medium",children:"Token Sharing"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transfer tokens between family members for redemption"})]}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg text-center",children:[e.jsx(D,{className:"h-8 w-8 mx-auto mb-2 text-blue-500"}),e.jsx("h4",{className:"font-medium",children:"Up to 5 Members"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add up to 5 family members to your premium plan"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx(o,{asChild:!0,size:"lg",children:e.jsx(ls,{to:"/premium",children:"Upgrade to Family Plan"})}),e.jsx("div",{className:"mt-2 text-sm text-center text-muted-foreground",children:"Starting at $149.99/year or $349.99 lifetime"})]})]})]})]}):x.isPlanOwner?e.jsxs("div",{className:"container max-w-6xl py-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Family Plan Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your family connections and settings"})]}),e.jsx(F,{className:"bg-primary/20 text-primary hover:bg-primary/30 border-primary/20",children:"Plan Owner"})]}),e.jsx(K,{}),e.jsxs(Ce,{defaultValue:n,onValueChange:m,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full max-w-md grid-cols-3",children:[e.jsxs(V,{value:"members",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Family Members"]}),e.jsxs(V,{value:"tokens",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Token Transfer"]}),e.jsxs(V,{value:"consent",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"My Consent"]})]}),e.jsx(Y,{value:"members",className:"pt-6",children:e.jsx(xs,{})}),e.jsx(Y,{value:"tokens",className:"pt-6",children:e.jsx(us,{})}),e.jsx(Y,{value:"consent",className:"pt-6",children:e.jsx(Fe,{})})]})]}):e.jsxs("div",{className:"container max-w-6xl py-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Family Plan"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your family connection settings"})]}),e.jsx(F,{className:"bg-blue-100 text-blue-700 hover:bg-blue-200 border-blue-200",children:"Family Member"})]}),e.jsx(K,{}),e.jsxs(Ee,{children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(Re,{children:"You're part of a family plan"}),e.jsx(Ue,{children:"You've been added to a family plan by another user. You can manage your consent settings below."})]}),e.jsx(Fe,{})]})}export{vs as default};
