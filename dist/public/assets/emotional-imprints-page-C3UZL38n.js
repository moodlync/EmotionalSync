import{c as X,u as Z,a as H,r as d,V as J,q as T,j as e,C as K,d as ee,e as se,f as de,o as xe,g as ae,ac as Le,bU as oe,bV as ie,a0 as De,B as j,bS as je,at as pe,aR as Te,ag as Me,R as N,l as ye,t as ve,b as le,a4 as fe,a5 as ge,a6 as z,F as Ne,a7 as O,w as S,x as k,v as F,y as P,I as me,z as A,D,G as I,H as G,J as _,K as U,M as b,E as be,b8 as qe,N as we,L as Ve,k as W,Y as Q,au as Y,aL as $e,aM as Be,aN as ze,S as Oe,aE as Ce,af as Ie,A as ue,h as he,i as ne,_ as Ge,$ as Ue,aO as He,aI as Ke,aJ as Se,aK as ke,p as Re,cd as _e}from"./index-FJB1i4HR.js";import{R as Qe,a as Ye}from"./radio-group-CdzVZY9p.js";import{B as Je}from"./bookmark-Bw-eOiaC.js";import{S as We}from"./save-c1sccU0T.js";import{C as Xe}from"./circle-plus-DXq7ajXO.js";import{F as Ze}from"./flag-BhW5yEXY.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=X("Grid2x2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=X("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=X("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=X("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ts=["Joy","Love","Hope","Gratitude","Serenity","Interest","Amusement","Pride","Contentment","Excitement","Relief","Anger","Fear","Sadness","Disgust","Shame","Guilt","Envy","Jealousy","Anxiety","Grief","Disappointment","Surprise","Confusion","Nostalgia","Anticipation","Boredom","Awe","Curiosity","Empathy","Satisfaction","Neutral"],B={positive:["Joy","Love","Hope","Gratitude","Serenity","Interest","Amusement","Pride","Contentment","Excitement","Relief"],negative:["Anger","Fear","Sadness","Disgust","Shame","Guilt","Envy","Jealousy","Anxiety","Grief","Disappointment"],neutral:["Surprise","Confusion","Nostalgia","Anticipation","Boredom","Awe","Curiosity","Empathy","Satisfaction","Neutral"]},ce={joy:"#FFD700",love:"#FF69B4",hope:"#ADD8E6",gratitude:"#9ACD32",serenity:"#E6E6FA",anger:"#FF0000",fear:"#800080",sadness:"#6495ED",disgust:"#008000",shame:"#8B4513",surprise:"#FF7F50",confusion:"#D8BFD8",nostalgia:"#DEB887",anticipation:"#FFA500",neutral:"#A9A9A9",excitement:"#FF1493",anxiety:"#4B0082",curiosity:"#40E0D0",grief:"#483D8B",awe:"#9932CC",pride:"#FFD700",guilt:"#8B0000",boredom:"#F5F5DC",relief:"#98FB98",contentment:"#87CEEB"},Pe=[{id:"gentle_waves",name:"Gentle Waves",emotion:"serenity"},{id:"soft_rain",name:"Soft Rain",emotion:"sadness"},{id:"birds_chirping",name:"Birds Chirping",emotion:"joy"},{id:"crackling_fire",name:"Crackling Fire",emotion:"contentment"},{id:"heartbeat",name:"Heartbeat",emotion:"anxiety"},{id:"wind_chimes",name:"Wind Chimes",emotion:"hope"},{id:"thunderstorm",name:"Thunderstorm",emotion:"fear"},{id:"piano_melody",name:"Piano Melody",emotion:"nostalgia"},{id:"drum_beat",name:"Drum Beat",emotion:"excitement"},{id:"church_bells",name:"Church Bells",emotion:"awe"},{id:"laughter",name:"Laughter",emotion:"amusement"},{id:"ticking_clock",name:"Ticking Clock",emotion:"anticipation"},{id:"deep_breath",name:"Deep Breath",emotion:"relief"},{id:"crowd_celebration",name:"Crowd Celebration",emotion:"pride"},{id:"glass_breaking",name:"Glass Breaking",emotion:"anger"}],Ee=[{id:"short",name:"Short Pulse",description:"A quick, single vibration"},{id:"long",name:"Long Pulse",description:"A sustained vibration"},{id:"double",name:"Double Pulse",description:"Two quick vibrations"},{id:"triple",name:"Triple Pulse",description:"Three quick vibrations"},{id:"escalating",name:"Escalating",description:"Vibrations that increase in duration"},{id:"heartbeat",name:"Heartbeat",description:"Mimics a heartbeat pattern"}],Ae=({imprint:s,isPreview:x=!1,onShare:f,onComment:i})=>{const{user:u}=Z(),{toast:p}=H(),[l,E]=d.useState(!1),[h,C]=d.useState(!1),[c,L]=d.useState(null),[y,g]=d.useState({liked:!1,saved:!1}),w=u&&s.userId===u.id;d.useEffect(()=>{if(s.soundId){const t=new Audio(`/sounds/${s.soundId}.mp3`);return t.loop=!0,L(t),()=>{t&&(t.pause(),t.currentTime=0)}}},[s.soundId]),d.useEffect(()=>{!x&&u&&!w&&o("view")},[]);const m=()=>{c&&(l?c.pause():c.play().catch(t=>{console.error("Error playing sound:",t),p({title:"Sound Playback Error",description:"There was an issue playing the sound. Try again later.",variant:"destructive"})}),E(!l))},r=()=>{c&&(c.muted=!c.muted,C(!h))},o=async t=>{if(!(!u||x))try{const v=await J("POST",`/api/emotional-imprints/${s.id}/interactions`,{interactionType:t});return t==="like"?g(R=>({...R,liked:!0})):t==="save"&&(g(R=>({...R,saved:!0})),p({title:"Imprint Saved",description:"This emotional imprint has been saved to your collection."})),T.invalidateQueries({queryKey:[`/api/emotional-imprints/${s.id}`]}),T.invalidateQueries({queryKey:["/api/emotional-imprints/my"]}),await v.json()}catch(v){console.error(`Error recording ${t} interaction:`,v),p({title:"Action Failed",description:`Failed to ${t} this imprint. Please try again.`,variant:"destructive"})}},q=()=>{y.liked||o("like")},M=()=>{y.saved||o("save")},n=()=>{f&&(o("share"),f(s))},V=()=>{i&&(o("comment"),i(s))},$=()=>s.colorCode&&ce[s.colorCode]?ce[s.colorCode]:"#e2e8f0",te=()=>{if(s.soundId){const t=Pe.find(v=>v.id===s.soundId);return t?t.name:"Unknown Sound"}return"No Sound"},a=()=>{if(s.vibrationPattern){const t=Ee.find(v=>v.id===s.vibrationPattern);return t?t.name:"Unknown Pattern"}return"No Vibration"};return e.jsxs(K,{className:"overflow-hidden border-2 transition-all duration-300 h-full",children:[e.jsx("div",{className:"h-20 w-full transition-all duration-500",style:{backgroundColor:$(),opacity:s.intensity?s.intensity/10:.8}}),e.jsx(ee,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-xl",children:s.name}),e.jsx(de,{children:s.author&&e.jsxs("span",{className:"text-sm",children:["By ",s.author.username]})})]}),e.jsx(xe,{variant:s.emotion==="Joy"||s.emotion==="Love"||s.emotion==="Hope"?"default":s.emotion==="Anger"||s.emotion==="Fear"||s.emotion==="Sadness"?"destructive":"secondary",children:s.emotion})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-4",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.intensity&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Intensity"}),e.jsxs("span",{children:[s.intensity,"/10"]})]}),e.jsx(Le,{value:s.intensity*10})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 text-xs",children:[s.colorCode&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:$()}}),e.jsx("span",{children:s.colorCode})]}),s.soundId&&e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(oe,{className:"w-4 h-4 text-primary"}):e.jsx(ie,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:te()})]}),s.vibrationPattern&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs",children:a()})})]})]})}),e.jsxs(De,{className:"pt-2 flex justify-between border-t",children:[e.jsxs("div",{className:"flex space-x-2",children:[s.soundId&&e.jsx(j,{variant:"ghost",size:"sm",onClick:m,className:"h-8 w-8 p-0","aria-label":l?"Pause sound":"Play sound",children:l?e.jsx(oe,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"})}),s.soundId&&e.jsx(j,{variant:"ghost",size:"sm",onClick:r,className:"h-8 w-8 p-0","aria-label":h?"Unmute sound":"Mute sound",disabled:!l,children:h?e.jsx(Fe,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]}),!x&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:q,className:`h-8 w-8 p-0 ${y.liked?"text-red-500":""}`,"aria-label":"Like",children:e.jsx(pe,{className:"h-4 w-4",fill:y.liked?"currentColor":"none"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:V,className:"h-8 w-8 p-0","aria-label":"Comment",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0","aria-label":"Share",children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:M,className:`h-8 w-8 p-0 ${y.saved?"text-primary":""}`,"aria-label":"Save",children:e.jsx(Je,{className:"h-4 w-4",fill:y.saved?"currentColor":"none"})})]})]})]})},ns=N.object({name:N.string().min(3,"Name must be at least 3 characters").max(50,"Name must be less than 50 characters"),emotion:N.string().min(1,"Emotion is required"),description:N.string().max(200,"Description must be less than 200 characters").optional(),intensity:N.number().min(1).max(10).default(5),colorCode:N.string().min(1,"Color is required"),soundId:N.string().optional(),vibrationPattern:N.string().optional(),isPrivate:N.boolean().default(!1)}),rs=({existingImprint:s,onSuccess:x,onCancel:f})=>{const{toast:i}=H(),[u,p]=d.useState(!1),[l,E]=d.useState(null),[h,C]=d.useState(!1);d.useState((s==null?void 0:s.colorCode)||"joy");const[c,L]=d.useState("details"),[y,g]=d.useState(null),w=!!s,m=ye({resolver:ve(ns),defaultValues:{name:(s==null?void 0:s.name)||"",emotion:(s==null?void 0:s.emotion)||"",description:(s==null?void 0:s.description)||"",intensity:(s==null?void 0:s.intensity)||5,colorCode:(s==null?void 0:s.colorCode)||"",soundId:(s==null?void 0:s.soundId)||"",vibrationPattern:(s==null?void 0:s.vibrationPattern)||"",isPrivate:(s==null?void 0:s.isPrivate)||!1}}),r=m.watch();d.useEffect(()=>{const a=m.watch("soundId");if(a){const t=new Audio(`/sounds/${a}.mp3`);return t.loop=!0,E(t),()=>{t&&(t.pause(),t.currentTime=0)}}else E(null),p(!1)},[m.watch("soundId")]),d.useEffect(()=>{g({id:(s==null?void 0:s.id)||0,userId:(s==null?void 0:s.userId)||0,name:r.name||"Untitled Imprint",emotion:r.emotion||"Neutral",description:r.description||"",intensity:r.intensity,colorCode:r.colorCode||"",soundId:r.soundId,vibrationPattern:r.vibrationPattern,isPrivate:r.isPrivate,createdAt:(s==null?void 0:s.createdAt)||new Date,updatedAt:new Date,author:s==null?void 0:s.author,interactions:(s==null?void 0:s.interactions)||[]})},[r,s]);const o=()=>{l&&(u?l.pause():l.play().catch(a=>{console.error("Error playing sound:",a),i({title:"Sound Playback Error",description:"There was an issue playing the sound. Try again later.",variant:"destructive"})}),p(!u))},q=()=>{l&&(l.muted=!l.muted,C(!h))},M=()=>{const a=m.watch("vibrationPattern");if(!a||!navigator.vibrate)return;const v={short:[200],long:[1e3],double:[200,100,200],triple:[200,100,200,100,200],escalating:[100,50,200,50,300],heartbeat:[100,30,100,500,100,30,100]}[a];v&&navigator.vibrate(v)},n=le({mutationFn:async a=>await(await J("POST","/api/emotional-imprints",a)).json(),onSuccess:a=>{i({title:"Imprint Created",description:"Your emotional imprint has been created successfully."}),T.invalidateQueries({queryKey:["/api/emotional-imprints"]}),T.invalidateQueries({queryKey:["/api/emotional-imprints/my"]}),m.reset(),x&&x(a)},onError:a=>{i({title:"Creation Failed",description:`Failed to create imprint: ${a.message}`,variant:"destructive"})}}),V=le({mutationFn:async a=>{const{id:t,...v}=a;return await(await J("PUT",`/api/emotional-imprints/${t}`,v)).json()},onSuccess:a=>{i({title:"Imprint Updated",description:"Your emotional imprint has been updated successfully."}),T.invalidateQueries({queryKey:["/api/emotional-imprints"]}),T.invalidateQueries({queryKey:["/api/emotional-imprints/my"]}),T.invalidateQueries({queryKey:[`/api/emotional-imprints/${a.id}`]}),x&&x(a)},onError:a=>{i({title:"Update Failed",description:`Failed to update imprint: ${a.message}`,variant:"destructive"})}}),$=a=>{w&&s?V.mutate({...a,id:s.id}):n.mutate(a)},te=()=>{f&&f()};return e.jsxs(K,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(ee,{children:[e.jsx(se,{children:w?"Edit Emotional Imprint":"Create Emotional Imprint"}),e.jsx(de,{children:"Capture your emotional state through a multi-sensory experience"})]}),e.jsx(ae,{children:e.jsxs(fe,{value:c,onValueChange:L,className:"space-y-4",children:[e.jsxs(ge,{className:"grid grid-cols-3 w-full",children:[e.jsx(z,{value:"details",children:"Basic Details"}),e.jsx(z,{value:"sensory",children:"Sensory Experience"}),e.jsx(z,{value:"preview",children:"Preview"})]}),e.jsx(Ne,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit($),className:"space-y-6",children:[e.jsxs(O,{value:"details",className:"space-y-4",children:[e.jsx(S,{control:m.control,name:"name",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Name"}),e.jsx(P,{children:e.jsx(me,{placeholder:"Give your emotional imprint a name",...a})}),e.jsx(A,{children:"A name that describes your emotional state or experience"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"emotion",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Emotion"}),e.jsxs(I,{onValueChange:a.onChange,value:a.value,children:[e.jsx(P,{children:e.jsx(G,{children:e.jsx(_,{placeholder:"Select an emotion"})})}),e.jsx(U,{children:ts.map(t=>e.jsx(b,{value:t,children:t},t))})]}),e.jsx(A,{children:"Select the primary emotion you're experiencing"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"description",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Description (Optional)"}),e.jsx(P,{children:e.jsx(be,{placeholder:"Describe your emotional experience...",className:"resize-none h-24",...a,value:a.value||""})}),e.jsx(A,{children:"A brief description of your emotional state or what triggered it"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"intensity",render:({field:a})=>e.jsxs(k,{children:[e.jsxs(F,{children:["Intensity: ",a.value,"/10"]}),e.jsx(P,{children:e.jsx(qe,{min:1,max:10,step:1,defaultValue:[a.value],onValueChange:t=>a.onChange(t[0]),className:"py-4"})}),e.jsx(A,{children:"How strongly are you experiencing this emotion?"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"isPrivate",render:({field:a})=>e.jsxs(k,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(F,{className:"text-base",children:"Private Imprint"}),e.jsx(A,{children:"Only visible to you and those you explicitly share with"})]}),e.jsx(P,{children:e.jsx(we,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),e.jsxs(O,{value:"sensory",className:"space-y-4",children:[e.jsx(S,{control:m.control,name:"colorCode",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Color"}),e.jsx(P,{children:e.jsx(Qe,{onValueChange:a.onChange,value:a.value,className:"grid grid-cols-4 gap-4 pt-2",children:Object.entries(ce).map(([t,v])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{value:t,id:`color-${t}`,className:"peer sr-only"}),e.jsxs(Ve,{htmlFor:`color-${t}`,className:"flex flex-col items-center justify-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary transition-all",children:[e.jsx("div",{className:"w-12 h-12 rounded-full mb-2",style:{backgroundColor:v}}),e.jsx("div",{className:"text-sm font-medium",children:t})]})]},t))})}),e.jsx(A,{children:"Select a color that represents your emotion"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"soundId",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Sound (Optional)"}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(I,{onValueChange:t=>{a.onChange(t),p(!1)},value:a.value||"",children:[e.jsx(P,{children:e.jsx(G,{className:"flex-1",children:e.jsx(_,{placeholder:"Select a sound"})})}),e.jsxs(U,{children:[e.jsx(b,{value:"",children:"No Sound"}),Pe.map(t=>e.jsx(b,{value:t.id,children:t.name},t.id))]})]}),a.value&&e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:o,children:u?e.jsx(oe,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:q,disabled:!u,children:h?e.jsx(Fe,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx(A,{children:"Choose a sound that complements your emotional state"}),e.jsx(D,{})]})}),e.jsx(S,{control:m.control,name:"vibrationPattern",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Vibration Pattern (Optional)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(I,{onValueChange:a.onChange,value:a.value||"",children:[e.jsx(P,{children:e.jsx(G,{className:"flex-1",children:e.jsx(_,{placeholder:"Select a vibration pattern"})})}),e.jsxs(U,{children:[e.jsx(b,{value:"",children:"No Vibration"}),Ee.map(t=>e.jsx(b,{value:t.id,children:t.name},t.id))]})]}),a.value&&e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:M,children:"Test"})]}),e.jsx(A,{children:"Select a vibration pattern that matches your emotional rhythm"}),e.jsx(D,{})]})})]}),e.jsx(O,{value:"preview",className:"py-4",children:e.jsxs("div",{className:"border rounded-lg p-6 bg-accent/10",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Imprint Preview"}),y?e.jsx(Ae,{imprint:y,isPreview:!0}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Complete the form to see a preview of your emotional imprint"})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:te,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:n.isPending||V.isPending,children:n.isPending||V.isPending?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),w?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),w?"Update Imprint":"Create Imprint"]})})]})]})})]})})]})},os=N.object({receiverId:N.string().min(1,"Recipient is required"),message:N.string().max(500).optional(),isAnonymous:N.boolean().default(!1)}),is=({imprint:s,onSuccess:x})=>{var m;const{toast:f}=H(),{user:i}=Z(),[u,p]=d.useState("");d.useState(!1);const[l,E]=d.useState([]),[h,C]=d.useState([]),c=ye({resolver:ve(os),defaultValues:{receiverId:"",message:"",isAnonymous:!1}}),{data:L,isLoading:y}=Q({queryKey:["/api/users/connections"],queryFn:Y({on401:"throw"}),onSuccess:r=>{Array.isArray(r)&&(E(r),C(r))},onError:r=>{console.error("Error fetching recipients:",r),f({title:"Failed to load connections",description:"Could not load your connections. Please try again.",variant:"destructive"})}});d.useEffect(()=>{if(l.length>0)if(u.trim()==="")C(l);else{const r=l.filter(o=>o.username.toLowerCase().includes(u.toLowerCase())||o.firstName&&o.firstName.toLowerCase().includes(u.toLowerCase())||o.lastName&&o.lastName.toLowerCase().includes(u.toLowerCase())||o.email&&o.email.toLowerCase().includes(u.toLowerCase()));C(r)}},[u,l]);const g=le({mutationFn:async r=>await(await J("POST",`/api/emotional-imprints/${s.id}/share`,r)).json(),onSuccess:()=>{f({title:"Imprint Shared",description:c.getValues("isAnonymous")?"Your emotional imprint has been shared anonymously.":"Your emotional imprint has been shared successfully."}),T.invalidateQueries({queryKey:["/api/emotional-imprints"]}),T.invalidateQueries({queryKey:["/api/emotional-imprints/shared"]}),c.reset(),x&&x()},onError:r=>{f({title:"Share Failed",description:`Failed to share imprint: ${r.message}`,variant:"destructive"})}}),w=r=>{g.mutate(r)};return l.find(r=>r.id.toString()===c.watch("receiverId")),e.jsxs(e.Fragment,{children:[e.jsxs($e,{children:[e.jsx(Be,{children:"Share Emotional Imprint"}),e.jsx(ze,{children:"Share your emotional experience with a friend or connection."})]}),e.jsx("div",{className:"my-4",children:e.jsxs(K,{className:"p-3 flex items-center gap-3 bg-accent/50",children:[e.jsx("div",{className:"w-10 h-10 rounded-full",style:{backgroundColor:s.colorCode?s.colorCode:"#e2e8f0"}}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description?s.description.length>50?`${s.description.substring(0,50)}...`:s.description:"No description"})]}),e.jsx(xe,{variant:"outline",children:s.emotion})]})}),e.jsx(Oe,{className:"my-4"}),e.jsx(Ne,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(w),className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"search-recipients",className:"text-sm font-medium",children:"Find a recipient"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{id:"search-recipients",placeholder:"Search by name, username, or email",value:u,onChange:r=>p(r.target.value),className:"pl-10"})]})]}),e.jsx(S,{control:c.control,name:"receiverId",render:({field:r})=>e.jsxs(k,{children:[e.jsx(F,{children:"Recipient"}),e.jsxs(I,{onValueChange:r.onChange,value:r.value,children:[e.jsx(P,{children:e.jsx(G,{children:e.jsx(_,{placeholder:"Select a recipient"})})}),e.jsx(U,{children:y?e.jsx("div",{className:"flex justify-center p-2",children:e.jsx(W,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center p-2 text-sm text-muted-foreground",children:[e.jsx(Ie,{className:"h-10 w-10 mb-2 opacity-20"}),e.jsx("p",{children:"No recipients found"})]}):h.map(o=>e.jsx(b,{value:o.id.toString(),className:"flex items-center py-1.5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ue,{className:"h-6 w-6 mr-2",children:[e.jsx(he,{src:o.profilePicture||""}),e.jsx(ne,{className:"text-xs",children:o.username.slice(0,2).toUpperCase()})]}),o.firstName&&o.lastName?`${o.firstName} ${o.lastName} (${o.username})`:o.username]})},o.id))})]}),e.jsx(D,{})]})}),e.jsx(S,{control:c.control,name:"message",render:({field:r})=>e.jsxs(k,{children:[e.jsx(F,{children:"Message (Optional)"}),e.jsx(P,{children:e.jsx(be,{placeholder:"Add a personal message to go with your emotional imprint...",className:"resize-none",...r,value:r.value||""})}),e.jsx(A,{children:"Your message will be sent along with the emotional imprint."}),e.jsx(D,{})]})}),e.jsx(S,{control:c.control,name:"isAnonymous",render:({field:r})=>e.jsxs(k,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(F,{className:"text-base",children:"Send Anonymously"}),e.jsx(A,{children:"Your identity will not be revealed to the recipient"})]}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{checked:r.value,onCheckedChange:r.onChange,"aria-readonly":!0}),r.value?e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Ue,{className:"h-4 w-4 text-muted-foreground"})]})})]})}),c.watch("receiverId")&&e.jsxs("div",{className:"rounded-lg border p-4 bg-accent/10",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Preview"}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ue,{className:"h-8 w-8",children:c.watch("isAnonymous")?e.jsx(ne,{className:"bg-muted",children:"?"}):e.jsxs(e.Fragment,{children:[e.jsx(he,{src:(i==null?void 0:i.profilePicture)||""}),e.jsx(ne,{children:(m=i==null?void 0:i.username)==null?void 0:m.slice(0,2).toUpperCase()})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c.watch("isAnonymous")?"Anonymous":i==null?void 0:i.username}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.watch("message")||"No message"}),e.jsx("div",{className:"h-2 w-16 rounded-full mt-1",style:{backgroundColor:s.colorCode||"#e2e8f0",opacity:.7}})]})]})]}),e.jsx(He,{children:e.jsx(j,{type:"submit",className:"w-full",disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Sharing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Share Imprint"]})})})]})})]})},re=({imprints:s,isLoading:x=!1,emptyMessage:f="No emotional imprints found",isUserImprints:i=!1,onEdit:u})=>{const{toast:p}=H();Z();const[l,E]=d.useState(""),[h,C]=d.useState("all"),[c,L]=d.useState(3),[y,g]=d.useState(null),[w,m]=d.useState(!1),r=s==null?void 0:s.filter(n=>{const V=l===""||n.name.toLowerCase().includes(l.toLowerCase())||n.description&&n.description.toLowerCase().includes(l.toLowerCase())||n.emotion.toLowerCase().includes(l.toLowerCase()),$=h==="all"||h==="positive"&&B.positive.includes(n.emotion)||h==="negative"&&B.negative.includes(n.emotion)||h==="neutral"&&B.neutral.includes(n.emotion)||n.emotion.toLowerCase()===h.toLowerCase();return V&&$}),o=n=>{g(n),m(!0)},q=n=>{p({title:"Comments Coming Soon",description:"The ability to comment on emotional imprints will be available soon."})},M=n=>{u&&u(n)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:"Search imprints...",value:l,onChange:n=>E(n.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{value:h,onValueChange:C,children:[e.jsxs(G,{className:"w-[180px]",children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:h==="all"?"All Emotions":h==="positive"?"Positive":h==="negative"?"Negative":h==="neutral"?"Neutral":h})]}),e.jsxs(U,{children:[e.jsx(b,{value:"all",children:"All Emotions"}),e.jsx(b,{value:"positive",children:"Positive"}),e.jsx(b,{value:"negative",children:"Negative"}),e.jsx(b,{value:"neutral",children:"Neutral"}),B.positive.map(n=>e.jsx(b,{value:n.toLowerCase(),children:n},n)),B.negative.map(n=>e.jsx(b,{value:n.toLowerCase(),children:n},n)),B.neutral.map(n=>e.jsx(b,{value:n.toLowerCase(),children:n},n))]})]}),e.jsxs("div",{className:"flex rounded-md border",children:[e.jsx(j,{variant:"ghost",size:"icon",className:`h-10 w-10 ${c===2?"bg-accent":""}`,onClick:()=>L(2),"aria-label":"Two columns",children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:`h-10 w-10 ${c===3?"bg-accent":""}`,onClick:()=>L(3),"aria-label":"Three columns",children:e.jsx(ss,{className:"h-4 w-4"})})]})]})]}),x?e.jsx("div",{className:"flex justify-center items-center h-60",children:e.jsx(W,{className:"h-10 w-10 animate-spin text-primary"})}):r&&r.length>0?e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-${c} gap-6`,children:r.map(n=>e.jsxs("div",{className:"h-full",children:[e.jsx(Ae,{imprint:n,onShare:o,onComment:q}),i&&u&&e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(j,{variant:"outline",size:"sm",onClick:()=>M(n),children:"Edit"})})]},n.id))}):e.jsxs(K,{className:"border-dashed",children:[e.jsx(ee,{className:"flex flex-row items-center justify-center pb-2",children:e.jsx(se,{className:"text-xl font-medium text-center text-muted-foreground",children:f})}),e.jsx(ae,{className:"flex justify-center p-6",children:e.jsx("div",{className:"flex flex-col items-center text-center max-w-md",children:e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:i?"You haven't created any emotional imprints yet. Create one to start capturing your emotional experiences.":"No emotional imprints match your search criteria. Try adjusting your filters or search term."})})})]}),e.jsx(Se,{open:w,onOpenChange:m,children:e.jsx(ke,{className:"sm:max-w-md",children:y&&e.jsx(is,{imprint:y,onSuccess:()=>{m(!1),g(null)}})})})]})},xs=()=>{const{toast:s}=H(),{user:x}=Z(),[f,i]=d.useState(!1),[u,p]=d.useState(),[l,E]=d.useState("my-imprints"),{data:h,isLoading:C,refetch:c}=Q({queryKey:["/api/emotional-imprints/my"],queryFn:Y({on401:"throw"}),enabled:!!x,onError:n=>{console.error("Error fetching emotional imprints:",n)}}),{data:L,isLoading:y,refetch:g}=Q({queryKey:["/api/emotional-imprints/shared"],queryFn:Y({on401:"throw"}),enabled:!!x,onError:n=>{console.error("Error fetching shared emotional imprints:",n)}}),{data:w,isLoading:m,refetch:r}=Q({queryKey:["/api/emotional-imprints/public"],queryFn:Y({on401:"returnNull"}),onError:n=>{console.error("Error fetching public emotional imprints:",n)}}),o=()=>{i(!1),p(void 0),c(),g(),r(),s({title:u?"Imprint Updated":"Imprint Created",description:u?"Your emotional imprint has been updated successfully.":"Your emotional imprint has been created and added to your collection."})},q=n=>{p(n),i(!0)},M=x==null?void 0:x.isPremium;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Emotional Imprints"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Capture, visualize, and share your emotional experiences through multi-sensory imprints"})]}),e.jsxs(j,{onClick:()=>{if(!M){s({title:"Premium Feature",description:"Emotional Imprints are a premium feature. Upgrade to create and share your own emotional experiences.",variant:"destructive"});return}p(void 0),i(!0)},className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Create Imprint"]})]}),M?e.jsxs(fe,{value:l,onValueChange:E,className:"mb-8",children:[e.jsxs(ge,{className:"grid grid-cols-3 mb-6",children:[e.jsx(z,{value:"my-imprints",children:"My Imprints"}),e.jsx(z,{value:"shared-imprints",children:"Shared With Me"}),e.jsx(z,{value:"discover",children:"Discover"})]}),e.jsxs(O,{value:"my-imprints",className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"My Emotional Imprints"}),e.jsx(re,{imprints:h,isLoading:C,emptyMessage:"You haven't created any emotional imprints yet",isUserImprints:!0,onEdit:q})]}),e.jsxs(O,{value:"shared-imprints",className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Shared With Me"}),e.jsx(re,{imprints:L,isLoading:y,emptyMessage:"No emotional imprints have been shared with you yet"})]}),e.jsxs(O,{value:"discover",className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Discover"}),e.jsx(re,{imprints:w,isLoading:m,emptyMessage:"No public emotional imprints available for discovery"})]})]}):e.jsxs(K,{className:"mb-8 border-dashed border-primary/50",children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"Premium Feature"]}),e.jsx(de,{children:"Emotional Imprints are available exclusively for premium members"})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx(pe,{className:"h-10 w-10 text-primary mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Capture Emotions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create rich, multi-sensory imprints with color, sound, and vibration to capture the essence of your emotions"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx(_e,{className:"h-10 w-10 text-primary mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Share & Connect"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share your emotional imprints with trusted connections to foster deeper understanding and empathy"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx(Ze,{className:"h-10 w-10 text-primary mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Track Progress"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor your emotional journey over time with saved imprints and discover patterns in your emotional well-being"})]})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(j,{className:"px-8",children:"Upgrade to Premium"})})]})]}),e.jsx(Se,{open:f,onOpenChange:n=>{n||p(void 0),i(n)},children:e.jsx(ke,{className:"sm:max-w-4xl",children:e.jsx(rs,{existingImprint:u,onSuccess:o,onCancel:()=>i(!1)})})})]})};export{xs as default};
