import{c as ue,u as J,a as W,r as f,n as F,b as v,j as e,Z as xe,_ as $,$ as q,B as m,a0 as E,V as le,R as oe,Q as I,t as c,q as j,A as D,h as K,i as A,av as G,k,S as Z,bq as ee,br as se,bs as ie,bt as Y,bx as he,m as pe,a5 as H,w as R,a7 as je}from"./index-CriQqr38.js";import{T as te}from"./thumbs-up-djK25Zdi.js";import{B as ae}from"./bookmark-CaaPHi0h.js";import{D as ve}from"./download-BKBF8NHx.js";import{E as ne}from"./ellipsis-vertical-QooTdRX_.js";import{S as ye}from"./square-pen-DUcQ0uPy.js";import{T as re}from"./trash-2-D2kKAsUM.js";import{C as _}from"./chevron-left-DBUJsU-a.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=ue("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);function fe({videoId:t}){const{user:i,isLoading:u}=J(),{toast:d}=W(),[a,x]=f.useState(null),{data:n,isLoading:p}=F({queryKey:[`/api/videos/${t}/like-status`],queryFn:async()=>{try{return await(await c("GET",`/api/videos/${t}/like-status`)).json()}catch{return{liked:!1}}},enabled:!!i}),{data:h,isLoading:N}=F({queryKey:[`/api/videos/${t}/save-status`],queryFn:async()=>{try{return await(await c("GET",`/api/videos/${t}/save-status`)).json()}catch{return{saved:!1}}},enabled:!!i}),{data:r,isLoading:y}=F({queryKey:[`/api/videos/${t}/follow-status`],queryFn:async()=>{try{return await(await c("GET",`/api/videos/${t}/follow-status`)).json()}catch{return{following:!1}}},enabled:!!i}),U=v({mutationFn:async()=>await(await c("POST",`/api/videos/${t}/social-like`)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/videos/${t}/like-status`]}),j.invalidateQueries({queryKey:[`/api/videos/${t}`]})},onError:l=>{d({title:"Error",description:"Could not like/unlike this video",variant:"destructive"})}}),S=v({mutationFn:async()=>await(await c("POST",`/api/videos/${t}/save`)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/videos/${t}/save-status`]})},onError:l=>{d({title:"Error",description:"Could not save/unsave this video",variant:"destructive"})}}),M=v({mutationFn:async()=>await(await c("POST",`/api/videos/${t}/follow`)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/videos/${t}/follow-status`]})},onError:l=>{d({title:"Error",description:"Could not follow/unfollow this video",variant:"destructive"})}}),T=v({mutationFn:async()=>await(await c("POST",`/api/videos/${t}/share`)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/videos/${t}`]});const l=`${window.location.origin}/videos/${t}`;navigator.clipboard.writeText(l).then(()=>{d({title:"Link copied!",description:"Video link copied to clipboard"})})},onError:l=>{d({title:"Error",description:"Could not share this video",variant:"destructive"})}}),Q=v({mutationFn:async()=>await(await c("POST",`/api/videos/${t}/download`)).json(),onSuccess:l=>{if(j.invalidateQueries({queryKey:[`/api/videos/${t}`]}),l.videoUrl){const C=document.createElement("a");C.href=l.videoUrl,C.download=`video-${t}.mp4`,document.body.appendChild(C),C.click(),document.body.removeChild(C)}},onError:l=>{d({title:"Error",description:"Could not download this video",variant:"destructive"})}}),P=()=>{if(!i){d({title:"Sign in required",description:"Please sign in to like this video"});return}x("like"),setTimeout(()=>x(null),500),U.mutate()},w=()=>{if(!i){d({title:"Sign in required",description:"Please sign in to save this video"});return}x("save"),setTimeout(()=>x(null),500),S.mutate()},b=()=>{if(!i){d({title:"Sign in required",description:"Please sign in to follow this video"});return}x("follow"),setTimeout(()=>x(null),500),M.mutate()},z=()=>{x("share"),setTimeout(()=>x(null),500),T.mutate()},V=()=>{x("download"),setTimeout(()=>x(null),500),Q.mutate()},L=u||p||N||y;return e.jsx("div",{className:"flex justify-center gap-2 md:gap-4 py-2 border-t border-b",children:e.jsxs(xe,{delayDuration:300,children:[e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:P,disabled:L||U.isPending,className:`space-x-1 ${a==="like"?"animate-pulse":""}`,children:[n!=null&&n.liked?e.jsx(te,{className:"h-5 w-5 fill-current"}):e.jsx(te,{className:"h-5 w-5"}),e.jsx("span",{children:"Like"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:n!=null&&n.liked?"Unlike this video":"Like this video"})})]}),e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>window.location.href="#comments-section",className:"space-x-1",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:"Comment"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:"Add a comment"})})]}),e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:z,disabled:T.isPending,className:`space-x-1 ${a==="share"?"animate-pulse":""}`,children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{children:"Share"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:"Share this video"})})]}),e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:w,disabled:L||S.isPending,className:`space-x-1 ${a==="save"?"animate-pulse":""}`,children:[h!=null&&h.saved?e.jsx(ae,{className:"h-5 w-5 fill-current"}):e.jsx(ae,{className:"h-5 w-5"}),e.jsx("span",{children:"Save"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:h!=null&&h.saved?"Remove from saved":"Save for later"})})]}),e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:b,disabled:L||M.isPending,className:`space-x-1 ${a==="follow"?"animate-pulse":""}`,children:[r!=null&&r.following?e.jsx(I,{className:"h-5 w-5 fill-current"}):e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{children:r!=null&&r.following?"Following":"Follow"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:r!=null&&r.following?"Unfollow this video":"Follow for updates"})})]}),e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:V,disabled:Q.isPending,className:`space-x-1 ${a==="download"?"animate-pulse":""}`,children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("span",{children:"Download"})]})}),e.jsx(E,{side:"bottom",children:e.jsx("p",{children:"Download this video"})})]})]})})}function Ne({videoId:t}){const{user:i}=J(),{toast:u}=W(),[d,a]=f.useState(""),[x,n]=f.useState(null),[p,h]=f.useState(""),[N,r]=f.useState(null),[y,U]=f.useState(""),[S,M]=f.useState({}),{data:T,isLoading:Q}=F({queryKey:[`/api/videos/${t}/comments`],queryFn:async()=>await(await c("GET",`/api/videos/${t}/comments`)).json()}),P=v({mutationFn:async s=>await(await c("POST",`/api/videos/${t}/comments`,{content:s,parentId:null})).json(),onSuccess:()=>{a(""),j.invalidateQueries({queryKey:[`/api/videos/${t}/comments`]}),u({title:"Comment added",description:"Your comment has been posted successfully"})},onError:s=>{u({title:"Error",description:"Could not add your comment",variant:"destructive"})}}),w=v({mutationFn:async({commentId:s,replyText:o})=>await(await c("POST",`/api/videos/${t}/comments`,{content:o,parentId:s})).json(),onSuccess:(s,o)=>{U(""),r(null),j.invalidateQueries({queryKey:[`/api/videos/${t}/comments`]}),j.invalidateQueries({queryKey:[`/api/comments/${o.commentId}/replies`]}),u({title:"Reply added",description:"Your reply has been posted successfully"})},onError:s=>{u({title:"Error",description:"Could not add your reply",variant:"destructive"})}}),b=v({mutationFn:async({commentId:s,content:o})=>await(await c("PUT",`/api/comments/${s}`,{content:o})).json(),onSuccess:()=>{n(null),h(""),j.invalidateQueries({queryKey:[`/api/videos/${t}/comments`]}),u({title:"Comment updated",description:"Your comment has been updated successfully"})},onError:s=>{u({title:"Error",description:"Could not update your comment",variant:"destructive"})}}),z=v({mutationFn:async s=>(await c("DELETE",`/api/comments/${s}`)).ok,onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/videos/${t}/comments`]}),u({title:"Comment deleted",description:"Your comment has been deleted successfully"})},onError:s=>{u({title:"Error",description:"Could not delete your comment",variant:"destructive"})}}),V=s=>F({queryKey:[`/api/comments/${s}/replies`],queryFn:async()=>await(await c("GET",`/api/comments/${s}/replies`)).json(),enabled:!!S[s]}),L=s=>{if(s.preventDefault(),!!d.trim()){if(!i){u({title:"Sign in required",description:"Please sign in to comment"});return}P.mutate(d)}},l=s=>{if(y.trim()){if(!i){u({title:"Sign in required",description:"Please sign in to reply"});return}w.mutate({commentId:s,replyText:y})}},C=s=>{n(s.id),h(s.content)},de=()=>{n(null),h("")},ce=s=>{p.trim()&&b.mutate({commentId:s,content:p})},me=s=>{M(o=>({...o,[s]:!o[s]}))},X=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),B=s=>s.substring(0,2).toUpperCase();return e.jsxs("div",{className:"space-y-6",id:"comments-section",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comments"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(D,{className:"h-10 w-10",children:[e.jsx(K,{src:(i==null?void 0:i.avatarUrl)||""}),e.jsx(A,{children:i?B(i.username):"GU"})]}),e.jsxs("form",{onSubmit:L,className:"flex-1 space-y-4",children:[e.jsx(G,{placeholder:"Add a comment...",value:d,onChange:s=>a(s.target.value),disabled:!i||P.isPending,className:"min-h-[80px]"}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(m,{type:"submit",disabled:!i||!d.trim()||P.isPending,children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Posting..."]}):"Post Comment"})})]})]}),e.jsx(Z,{className:"my-6"}),e.jsx("div",{className:"space-y-6",children:Q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):T&&T.length>0?T.map(s=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(D,{className:"h-10 w-10",children:[e.jsx(K,{src:s.userAvatarUrl||""}),e.jsx(A,{children:B(s.username)})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:s.username}),e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:X(s.createdAt)})]}),i&&s.userId===i.id&&e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs(ie,{align:"end",children:[e.jsxs(Y,{onClick:()=>C(s),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Y,{onClick:()=>z.mutate(s.id),className:"text-destructive",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),x===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{value:p,onChange:o=>h(o.target.value),disabled:b.isPending,className:"min-h-[80px]"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:de,disabled:b.isPending,children:"Cancel"}),e.jsx(m,{size:"sm",onClick:()=>ce(s.id),disabled:!p.trim()||p===s.content||b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-3 w-3 animate-spin"}),"Saving..."]}):"Save"})]})]}):e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:"flex gap-4 pt-1",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>r(N===s.id?null:s.id),children:[e.jsx(ge,{className:"mr-1 h-3 w-3"}),"Reply"]}),s.replyCount>0&&e.jsxs(m,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>me(s.id),children:[S[s.id]?"Hide":"View"," ",s.replyCount," ",s.replyCount===1?"reply":"replies"]})]}),N===s.id&&e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsxs(D,{className:"h-8 w-8",children:[e.jsx(K,{src:(i==null?void 0:i.avatarUrl)||""}),e.jsx(A,{children:i?B(i.username):"GU"})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(G,{placeholder:`Reply to ${s.username}...`,value:y,onChange:o=>U(o.target.value),disabled:!i||w.isPending,className:"min-h-[60px] text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>r(null),disabled:w.isPending,children:"Cancel"}),e.jsx(m,{size:"sm",onClick:()=>l(s.id),disabled:!i||!y.trim()||w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-3 w-3 animate-spin"}),"Posting..."]}):"Post"})]})]})]})]})]}),S[s.id]&&e.jsx("div",{className:"ml-12 mt-2 space-y-4 border-l-2 border-muted pl-4",children:(()=>{const{data:o,isLoading:O}=V(s.id);return O?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{className:"h-6 w-6 animate-spin text-primary"})}):o&&o.length>0?o.map(g=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(D,{className:"h-8 w-8",children:[e.jsx(K,{src:g.userAvatarUrl||""}),e.jsx(A,{children:B(g.username)})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-sm",children:g.username}),e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:X(g.createdAt)})]}),i&&g.userId===i.id&&e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(ne,{className:"h-3 w-3"})})}),e.jsx(ie,{align:"end",children:e.jsxs(Y,{onClick:()=>z.mutate(g.id),className:"text-destructive",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete"]})})]})]}),e.jsx("p",{className:"text-sm",children:g.content})]})]},g.id)):e.jsx("p",{className:"py-2 text-sm text-muted-foreground",children:"No replies yet"})})()})]},s.id)):e.jsxs("div",{className:"py-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"No comments yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to comment on this video"})]})})]})}function qe(){var N;const[,t]=he("/video/:id"),i=parseInt((t==null?void 0:t.id)||"0",10);J();const u=pe(),{toast:d}=W(),{data:a,isLoading:x,error:n,isError:p}=F({queryKey:["/api/videos",i],queryFn:async()=>i?await(await c("GET",`/api/videos/${i}`)).json():null,enabled:!!i,retry:1});v({mutationFn:async()=>await(await c("POST",`/api/videos/${i}/like`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/videos",i]}),d({title:"Video liked",description:"You've liked this video!",variant:"default"})}}),v({mutationFn:async()=>await(await c("POST",`/api/videos/${i}/share`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/videos",i]}),d({title:"Video shared",description:"This video has been shared!",variant:"default"})}});const h=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"";return f.useEffect(()=>{p&&(n==null?void 0:n.error)==="Premium required"&&d({title:"Premium Required",description:"This video is only available to premium members. Upgrade to access exclusive content.",variant:"destructive"})},[p,n,d]),x?e.jsx("div",{className:"container max-w-6xl py-8 flex items-center justify-center min-h-[50vh]",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):p?e.jsxs("div",{className:"container max-w-6xl py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(H,{to:"/videos",className:"flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Back to videos"]})}),e.jsxs("div",{className:"bg-destructive/10 text-destructive rounded-md p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:(n==null?void 0:n.error)==="Premium required"?"Premium Required":"Video Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(n==null?void 0:n.message)||"This video could not be loaded. It may have been removed or you might not have permission to view it."}),(n==null?void 0:n.error)==="Premium required"&&e.jsx(m,{children:"Upgrade to Premium"})]})]}):a?e.jsxs("div",{className:"container max-w-6xl py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(H,{to:"/videos",className:"flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Back to videos"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"bg-black aspect-video rounded-lg overflow-hidden mb-4",children:a.videoUrl?e.jsx("video",{src:a.videoUrl,controls:!0,poster:a.thumbnailUrl||void 0,className:"w-full h-full object-contain"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-white"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:a.title}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(D,{children:[e.jsx(A,{children:((N=a.username)==null?void 0:N.charAt(0))||"U"}),a.userAvatarUrl&&e.jsx(K,{src:a.userAvatarUrl})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.username||"Anonymous User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h(a.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(R,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{children:a.likes||0})]}),e.jsxs(R,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),e.jsx("span",{children:a.shares||0})]}),e.jsxs(R,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),e.jsx("span",{children:0})]})]})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:a.description})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Category"}),e.jsx(R,{variant:"secondary",children:a.category.replace("_"," ").replace(/\b\w/g,r=>r.toUpperCase())}),a.tags&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.tags.split(",").map((r,y)=>e.jsxs(R,{variant:"outline",className:"text-xs",children:["#",r.trim()]},y))})]}),e.jsx(fe,{videoId:i}),e.jsx(Z,{className:"my-6"}),e.jsx(Ne,{videoId:i})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Related Videos"}),e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Related videos coming soon..."})})]})]})]}):e.jsxs("div",{className:"container max-w-6xl py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(H,{to:"/videos",className:"flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Back to videos"]})}),e.jsxs("div",{className:"bg-muted rounded-md p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Video Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"This video does not exist or has been removed."})]})]})}export{qe as default};
