import{a as B,m as K,r as l,n as A,b as F,j as e,k as T,B as E,b6 as V,aj as _,I as z,a_ as j,a$ as g,b0 as f,b1 as v,b2 as a,C as H,d as O,e as G,f as Y,g as J,t as u}from"./index-CriQqr38.js";import{A as y}from"./admin-layout-C038jqd_.js";import"./log-out-BF9kSmxu.js";import"./rotate-ccw-BlpTPyoF.js";import"./quote-Bd4aNfLu.js";function re({defaultStatus:P}){const{toast:d}=B(),N=K(),[n,R]=l.useState(null),[c,L]=l.useState(P||""),[x,W]=l.useState(""),[o,D]=l.useState(""),[h,U]=l.useState(""),{data:b,isLoading:$,error:p,refetch:q}=A({queryKey:["/api/admin/tickets",c,x,o],queryFn:async()=>{const s=new URLSearchParams;c&&s.append("status",c),x&&s.append("category",x),o&&s.append("priority",o);const r=await u("GET",`/api/admin/tickets${s.toString()?`?${s.toString()}`:""}`);if(!r.ok)throw new Error("Failed to fetch tickets");return r.json()}}),w=F({mutationFn:async({ticketId:s,status:r})=>{const i=await u("PATCH",`/api/admin/tickets/${s}`,{status:r});if(!i.ok)throw new Error("Failed to update ticket");return i.json()},onSuccess:()=>{N.invalidateQueries({queryKey:["/api/admin/tickets"]}),d({title:"Ticket updated",description:"The ticket status has been updated successfully"})},onError:s=>{d({title:"Update failed",description:s instanceof Error?s.message:"Failed to update ticket",variant:"destructive"})}}),{data:t,isLoading:X}=A({queryKey:["/api/admin/tickets",n],queryFn:async()=>{if(!n)return null;const s=await u("GET",`/api/admin/tickets/${n}`);if(!s.ok)throw new Error("Failed to fetch ticket details");return s.json()},enabled:!!n}),m=F({mutationFn:async({ticketId:s,content:r})=>{const i=await u("POST",`/api/admin/tickets/${s}/responses`,{content:r});if(!i.ok)throw new Error("Failed to add response");return i.json()},onSuccess:()=>{N.invalidateQueries({queryKey:["/api/admin/tickets",n]}),d({title:"Response added",description:"Your response has been added to the ticket"})},onError:s=>{d({title:"Failed to add response",description:s instanceof Error?s.message:"Failed to add response",variant:"destructive"})}}),k=b?b.filter(s=>{if(h==="")return!0;const r=h.toLowerCase();return s.subject.toLowerCase().includes(r)||s.description.toLowerCase().includes(r)||s.id.toString().includes(r)}):[],I=async(s,r)=>{await w.mutateAsync({ticketId:s,status:r})},Q=async(s,r)=>{s.preventDefault();const i=s.target,C=i.response.value;if(!C.trim()){d({title:"Empty response",description:"Please enter a response",variant:"destructive"});return}await m.mutateAsync({ticketId:r,content:C}),i.reset()},S=s=>{switch(s){case"open":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-amber-100 text-amber-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";case"escalated":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},M=s=>{switch(s){case"low":return"bg-blue-100 text-blue-800";case"medium":return"bg-amber-100 text-amber-800";case"high":return"bg-orange-100 text-orange-800";case"urgent":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return $?e.jsx(y,{children:e.jsx("div",{className:"flex justify-center items-center h-[80vh]",children:e.jsx(T,{className:"h-8 w-8 animate-spin text-primary"})})}):p?e.jsx(y,{children:e.jsxs("div",{className:"rounded-lg border border-destructive p-4 text-destructive",children:[e.jsx("p",{children:"Error loading tickets"}),e.jsx("p",{className:"text-sm",children:p instanceof Error?p.message:"Unknown error"})]})}):e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and respond to user support tickets"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>q(),className:"h-8 gap-1",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(z,{type:"search",placeholder:"Search tickets...",className:"pl-8",value:h,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{value:c,onValueChange:L,children:[e.jsx(g,{className:"w-[140px]",children:e.jsx(f,{placeholder:"All statuses"})}),e.jsxs(v,{children:[e.jsx(a,{value:"",children:"All statuses"}),e.jsx(a,{value:"open",children:"Open"}),e.jsx(a,{value:"in_progress",children:"In Progress"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"closed",children:"Closed"}),e.jsx(a,{value:"escalated",children:"Escalated"})]})]}),e.jsxs(j,{value:o,onValueChange:D,children:[e.jsx(g,{className:"w-[140px]",children:e.jsx(f,{placeholder:"All priorities"})}),e.jsxs(v,{children:[e.jsx(a,{value:"",children:"All priorities"}),e.jsx(a,{value:"low",children:"Low"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-muted/50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"flex gap-4",children:e.jsx("span",{className:"font-medium",children:"Ticket"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("span",{className:"font-medium hidden md:block",children:"Status"}),e.jsx("span",{className:"font-medium hidden md:block",children:"Priority"}),e.jsx("span",{className:"font-medium hidden md:block",children:"Date"})]})]})}),e.jsx("div",{className:"divide-y",children:k.length>0?k.map(s=>e.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-muted/50",onClick:()=>R(s.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.subject}),e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["User ID: #",s.userId]})]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${S(s.status)}`,children:s.status}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${M(s.priority)} hidden md:inline-block`,children:s.priority}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap hidden md:block",children:new Date(s.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},s.id)):e.jsx("div",{className:"px-4 py-8 text-center text-muted-foreground",children:"No tickets found"})})]})]}),n&&t&&e.jsx("div",{className:"w-full md:w-[400px]",children:e.jsxs(H,{className:"sticky top-6",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(G,{children:t.ticket.subject}),e.jsxs(Y,{children:["Ticket #",t.ticket.id]})]}),e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${S(t.ticket.status)}`,children:t.ticket.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(t.ticket.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Description"}),e.jsx("p",{className:"text-sm",children:t.ticket.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"User ID"}),e.jsxs("p",{className:"text-sm",children:["#",t.ticket.userId]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Category"}),e.jsx("p",{className:"text-sm capitalize",children:t.ticket.category})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Priority"}),e.jsx("p",{className:"text-sm capitalize",children:t.ticket.priority})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Status"}),e.jsxs(j,{value:t.ticket.status,onValueChange:s=>I(t.ticket.id,s),disabled:w.isPending,children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(v,{children:[e.jsx(a,{value:"open",children:"Open"}),e.jsx(a,{value:"in_progress",children:"In Progress"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"closed",children:"Closed"}),e.jsx(a,{value:"escalated",children:"Escalated"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Responses"}),t.responses&&t.responses.length>0?e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2",children:t.responses.map(s=>e.jsxs("div",{className:`p-3 rounded-lg text-sm ${s.isAdminResponse?"bg-primary/10 ml-4":"bg-muted mr-4"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium",children:s.isAdminResponse?"Admin":"User"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{children:s.content})]},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No responses yet"})]}),e.jsxs("form",{onSubmit:s=>Q(s,t.ticket.id),children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Add Response"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{name:"response",className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Type your response here...",disabled:m.isPending}),e.jsx(E,{type:"submit",disabled:m.isPending,className:"w-full",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):"Send Response"})]})]})]})]})})]})]})})}export{re as default};
