import{r as i,ax as ce,ay as se,az as je,aA as Ts,aB as Rs,aC as Es,aD as As,j as e,al as de,aE as ns,a as Le,Y as ye,V as Me,l as rs,b as be,C as $,g as D,F as is,w as _,x as V,v as O,aF as Ps,aG as Is,B as R,A as Te,h as Re,i as Ee,aH as Fs,D as J,y as G,I as oe,z as ke,E as ls,aI as Ms,aJ as Be,aK as Ve,aL as Oe,aM as Ue,aN as Ke,L as fe,a1 as os,aO as Ye,aP as He,R as Y,t as cs,q as Q,d as U,e as K,aQ as qs,ag as $s,Q as Ds,aR as ds,a0 as te,aS as Ls,k as he,u as ms,a4 as ze,a5 as We,a6 as X,a7 as Z,f as pe,aT as Ne,ac as Bs,aU as Vs,ak as Os,aV as Us,o as re,av as Ze,S as qe,ae as Ks,aa as Ys,aW as Hs,aX as zs,ar as Ws,am as Gs}from"./index-FJB1i4HR.js";import{A as Qs,a as _s,b as Js}from"./alert-DPSoV0TE.js";import{A as Xs}from"./animated-share-button-_as771aq.js";import{C as Zs}from"./copy-Ben7Z46t.js";import{T as et,F as st,L as tt}from"./twitter-DgIHAATl.js";import{v as es}from"./v4-CmTdKEVZ.js";import{R as at,a as Ae}from"./radio-group-CdzVZY9p.js";import{R as us}from"./repeat-CrecBiLY.js";import{T as nt}from"./thumbs-up-d6JypP4Q.js";var ss=1,rt=.9,it=.8,lt=.17,Pe=.1,Ie=.999,ot=.9999,ct=.99,dt=/[\\\/_+.#"@\[\(\{&]/,mt=/[\\\/_+.#"@\[\(\{&]/g,ut=/[\s-]/,hs=/[\s-]/g;function $e(s,r,a,l,o,d,m){if(d===r.length)return o===s.length?ss:ct;var t=`${o},${d}`;if(m[t]!==void 0)return m[t];for(var y=l.charAt(d),c=a.indexOf(y,o),j=0,g,C,f,k;c>=0;)g=$e(s,r,a,l,c+1,d+1,m),g>j&&(c===o?g*=ss:dt.test(s.charAt(c-1))?(g*=it,f=s.slice(o,c-1).match(mt),f&&o>0&&(g*=Math.pow(Ie,f.length))):ut.test(s.charAt(c-1))?(g*=rt,k=s.slice(o,c-1).match(hs),k&&o>0&&(g*=Math.pow(Ie,k.length))):(g*=lt,o>0&&(g*=Math.pow(Ie,c-o))),s.charAt(c)!==r.charAt(d)&&(g*=ot)),(g<Pe&&a.charAt(c-1)===l.charAt(d+1)||l.charAt(d+1)===l.charAt(d)&&a.charAt(c-1)!==l.charAt(d))&&(C=$e(s,r,a,l,c+1,d+2,m),C*Pe>g&&(g=C*Pe)),g>j&&(j=g),c=a.indexOf(y,c+1);return m[t]=j,j}function ts(s){return s.toLowerCase().replace(hs," ")}function ht(s,r,a){return s=a&&a.length>0?`${s+" "+a.join(" ")}`:s,$e(s,r,ts(s),ts(r),0,0,{})}var xe='[cmdk-group=""]',Fe='[cmdk-group-items=""]',xt='[cmdk-group-heading=""]',xs='[cmdk-item=""]',as=`${xs}:not([aria-disabled="true"])`,De="cmdk-item-select",ie="data-value",pt=(s,r,a)=>ht(s,r,a),ps=i.createContext(void 0),ge=()=>i.useContext(ps),fs=i.createContext(void 0),Ge=()=>i.useContext(fs),js=i.createContext(void 0),gs=i.forwardRef((s,r)=>{let a=le(()=>{var n,p;return{search:"",value:(p=(n=s.value)!=null?n:s.defaultValue)!=null?p:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),l=le(()=>new Set),o=le(()=>new Map),d=le(()=>new Map),m=le(()=>new Set),t=vs(s),{label:y,children:c,value:j,onValueChange:g,filter:C,shouldFilter:f,loop:k,disablePointerSelection:E=!1,vimBindings:q=!0,...H}=s,b=ce(),z=ce(),P=ce(),x=i.useRef(null),S=St();ae(()=>{if(j!==void 0){let n=j.trim();a.current.value=n,F.emit()}},[j]),ae(()=>{S(6,v)},[]);let F=i.useMemo(()=>({subscribe:n=>(m.current.add(n),()=>m.current.delete(n)),snapshot:()=>a.current,setState:(n,p,N)=>{var h,w,T,B;if(!Object.is(a.current[n],p)){if(a.current[n]=p,n==="search")u(),W(),S(1,ue);else if(n==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let M=document.getElementById(P);M?M.focus():(h=document.getElementById(b))==null||h.focus()}if(S(7,()=>{var M;a.current.selectedItemId=(M=A())==null?void 0:M.id,F.emit()}),N||S(5,v),((w=t.current)==null?void 0:w.value)!==void 0){let M=p??"";(B=(T=t.current).onValueChange)==null||B.call(T,M);return}}F.emit()}},emit:()=>{m.current.forEach(n=>n())}}),[]),me=i.useMemo(()=>({value:(n,p,N)=>{var h;p!==((h=d.current.get(n))==null?void 0:h.value)&&(d.current.set(n,{value:p,keywords:N}),a.current.filtered.items.set(n,ne(p,N)),S(2,()=>{W(),F.emit()}))},item:(n,p)=>(l.current.add(n),p&&(o.current.has(p)?o.current.get(p).add(n):o.current.set(p,new Set([n]))),S(3,()=>{u(),W(),a.current.value||ue(),F.emit()}),()=>{d.current.delete(n),l.current.delete(n),a.current.filtered.items.delete(n);let N=A();S(4,()=>{u(),(N==null?void 0:N.getAttribute("id"))===n&&ue(),F.emit()})}),group:n=>(o.current.has(n)||o.current.set(n,new Set),()=>{d.current.delete(n),o.current.delete(n)}),filter:()=>t.current.shouldFilter,label:y||s["aria-label"],getDisablePointerSelection:()=>t.current.disablePointerSelection,listId:b,inputId:P,labelId:z,listInnerRef:x}),[]);function ne(n,p){var N,h;let w=(h=(N=t.current)==null?void 0:N.filter)!=null?h:pt;return n?w(n,a.current.search,p):0}function W(){if(!a.current.search||t.current.shouldFilter===!1)return;let n=a.current.filtered.items,p=[];a.current.filtered.groups.forEach(h=>{let w=o.current.get(h),T=0;w.forEach(B=>{let M=n.get(B);T=Math.max(M,T)}),p.push([h,T])});let N=x.current;I().sort((h,w)=>{var T,B;let M=h.getAttribute("id"),ve=w.getAttribute("id");return((T=n.get(ve))!=null?T:0)-((B=n.get(M))!=null?B:0)}).forEach(h=>{let w=h.closest(Fe);w?w.appendChild(h.parentElement===w?h:h.closest(`${Fe} > *`)):N.appendChild(h.parentElement===N?h:h.closest(`${Fe} > *`))}),p.sort((h,w)=>w[1]-h[1]).forEach(h=>{var w;let T=(w=x.current)==null?void 0:w.querySelector(`${xe}[${ie}="${encodeURIComponent(h[0])}"]`);T==null||T.parentElement.appendChild(T)})}function ue(){let n=I().find(N=>N.getAttribute("aria-disabled")!=="true"),p=n==null?void 0:n.getAttribute(ie);F.setState("value",p||void 0)}function u(){var n,p,N,h;if(!a.current.search||t.current.shouldFilter===!1){a.current.filtered.count=l.current.size;return}a.current.filtered.groups=new Set;let w=0;for(let T of l.current){let B=(p=(n=d.current.get(T))==null?void 0:n.value)!=null?p:"",M=(h=(N=d.current.get(T))==null?void 0:N.keywords)!=null?h:[],ve=ne(B,M);a.current.filtered.items.set(T,ve),ve>0&&w++}for(let[T,B]of o.current)for(let M of B)if(a.current.filtered.items.get(M)>0){a.current.filtered.groups.add(T);break}a.current.filtered.count=w}function v(){var n,p,N;let h=A();h&&(((n=h.parentElement)==null?void 0:n.firstChild)===h&&((N=(p=h.closest(xe))==null?void 0:p.querySelector(xt))==null||N.scrollIntoView({block:"nearest"})),h.scrollIntoView({block:"nearest"}))}function A(){var n;return(n=x.current)==null?void 0:n.querySelector(`${xs}[aria-selected="true"]`)}function I(){var n;return Array.from(((n=x.current)==null?void 0:n.querySelectorAll(as))||[])}function Ce(n){let p=I()[n];p&&F.setState("value",p.getAttribute(ie))}function Se(n){var p;let N=A(),h=I(),w=h.findIndex(B=>B===N),T=h[w+n];(p=t.current)!=null&&p.loop&&(T=w+n<0?h[h.length-1]:w+n===h.length?h[0]:h[w+n]),T&&F.setState("value",T.getAttribute(ie))}function Qe(n){let p=A(),N=p==null?void 0:p.closest(xe),h;for(;N&&!h;)N=n>0?wt(N,xe):Ct(N,xe),h=N==null?void 0:N.querySelector(as);h?F.setState("value",h.getAttribute(ie)):Se(n)}let _e=()=>Ce(I().length-1),Je=n=>{n.preventDefault(),n.metaKey?_e():n.altKey?Qe(1):Se(1)},Xe=n=>{n.preventDefault(),n.metaKey?Ce(0):n.altKey?Qe(-1):Se(-1)};return i.createElement(se.div,{ref:r,tabIndex:-1,...H,"cmdk-root":"",onKeyDown:n=>{var p;(p=H.onKeyDown)==null||p.call(H,n);let N=n.nativeEvent.isComposing||n.keyCode===229;if(!(n.defaultPrevented||N))switch(n.key){case"n":case"j":{q&&n.ctrlKey&&Je(n);break}case"ArrowDown":{Je(n);break}case"p":case"k":{q&&n.ctrlKey&&Xe(n);break}case"ArrowUp":{Xe(n);break}case"Home":{n.preventDefault(),Ce(0);break}case"End":{n.preventDefault(),_e();break}case"Enter":{n.preventDefault();let h=A();if(h){let w=new Event(De);h.dispatchEvent(w)}}}}},i.createElement("label",{"cmdk-label":"",htmlFor:me.inputId,id:me.labelId,style:Rt},y),we(s,n=>i.createElement(fs.Provider,{value:F},i.createElement(ps.Provider,{value:me},n))))}),ft=i.forwardRef((s,r)=>{var a,l;let o=ce(),d=i.useRef(null),m=i.useContext(js),t=ge(),y=vs(s),c=(l=(a=y.current)==null?void 0:a.forceMount)!=null?l:m==null?void 0:m.forceMount;ae(()=>{if(!c)return t.item(o,m==null?void 0:m.id)},[c]);let j=Ns(o,d,[s.value,s.children,d],s.keywords),g=Ge(),C=ee(S=>S.value&&S.value===j.current),f=ee(S=>c||t.filter()===!1?!0:S.search?S.filtered.items.get(o)>0:!0);i.useEffect(()=>{let S=d.current;if(!(!S||s.disabled))return S.addEventListener(De,k),()=>S.removeEventListener(De,k)},[f,s.onSelect,s.disabled]);function k(){var S,F;E(),(F=(S=y.current).onSelect)==null||F.call(S,j.current)}function E(){g.setState("value",j.current,!0)}if(!f)return null;let{disabled:q,value:H,onSelect:b,forceMount:z,keywords:P,...x}=s;return i.createElement(se.div,{ref:je(d,r),...x,id:o,"cmdk-item":"",role:"option","aria-disabled":!!q,"aria-selected":!!C,"data-disabled":!!q,"data-selected":!!C,onPointerMove:q||t.getDisablePointerSelection()?void 0:E,onClick:q?void 0:k},s.children)}),jt=i.forwardRef((s,r)=>{let{heading:a,children:l,forceMount:o,...d}=s,m=ce(),t=i.useRef(null),y=i.useRef(null),c=ce(),j=ge(),g=ee(f=>o||j.filter()===!1?!0:f.search?f.filtered.groups.has(m):!0);ae(()=>j.group(m),[]),Ns(m,t,[s.value,s.heading,y]);let C=i.useMemo(()=>({id:m,forceMount:o}),[o]);return i.createElement(se.div,{ref:je(t,r),...d,"cmdk-group":"",role:"presentation",hidden:g?void 0:!0},a&&i.createElement("div",{ref:y,"cmdk-group-heading":"","aria-hidden":!0,id:c},a),we(s,f=>i.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?c:void 0},i.createElement(js.Provider,{value:C},f))))}),gt=i.forwardRef((s,r)=>{let{alwaysRender:a,...l}=s,o=i.useRef(null),d=ee(m=>!m.search);return!a&&!d?null:i.createElement(se.div,{ref:je(o,r),...l,"cmdk-separator":"",role:"separator"})}),vt=i.forwardRef((s,r)=>{let{onValueChange:a,...l}=s,o=s.value!=null,d=Ge(),m=ee(c=>c.search),t=ee(c=>c.selectedItemId),y=ge();return i.useEffect(()=>{s.value!=null&&d.setState("search",s.value)},[s.value]),i.createElement(se.input,{ref:r,...l,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":y.listId,"aria-labelledby":y.labelId,"aria-activedescendant":t,id:y.inputId,type:"text",value:o?s.value:m,onChange:c=>{o||d.setState("search",c.target.value),a==null||a(c.target.value)}})}),Nt=i.forwardRef((s,r)=>{let{children:a,label:l="Suggestions",...o}=s,d=i.useRef(null),m=i.useRef(null),t=ee(c=>c.selectedItemId),y=ge();return i.useEffect(()=>{if(m.current&&d.current){let c=m.current,j=d.current,g,C=new ResizeObserver(()=>{g=requestAnimationFrame(()=>{let f=c.offsetHeight;j.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return C.observe(c),()=>{cancelAnimationFrame(g),C.unobserve(c)}}},[]),i.createElement(se.div,{ref:je(d,r),...o,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":t,"aria-label":l,id:y.listId},we(s,c=>i.createElement("div",{ref:je(m,y.listInnerRef),"cmdk-list-sizer":""},c)))}),yt=i.forwardRef((s,r)=>{let{open:a,onOpenChange:l,overlayClassName:o,contentClassName:d,container:m,...t}=s;return i.createElement(Ts,{open:a,onOpenChange:l},i.createElement(Rs,{container:m},i.createElement(Es,{"cmdk-overlay":"",className:o}),i.createElement(As,{"aria-label":s.label,"cmdk-dialog":"",className:d},i.createElement(gs,{ref:r,...t}))))}),bt=i.forwardRef((s,r)=>ee(a=>a.filtered.count===0)?i.createElement(se.div,{ref:r,...s,"cmdk-empty":"",role:"presentation"}):null),kt=i.forwardRef((s,r)=>{let{progress:a,children:l,label:o="Loading...",...d}=s;return i.createElement(se.div,{ref:r,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},we(s,m=>i.createElement("div",{"aria-hidden":!0},m)))}),L=Object.assign(gs,{List:Nt,Item:ft,Input:vt,Group:jt,Separator:gt,Dialog:yt,Empty:bt,Loading:kt});function wt(s,r){let a=s.nextElementSibling;for(;a;){if(a.matches(r))return a;a=a.nextElementSibling}}function Ct(s,r){let a=s.previousElementSibling;for(;a;){if(a.matches(r))return a;a=a.previousElementSibling}}function vs(s){let r=i.useRef(s);return ae(()=>{r.current=s}),r}var ae=typeof window>"u"?i.useEffect:i.useLayoutEffect;function le(s){let r=i.useRef();return r.current===void 0&&(r.current=s()),r}function ee(s){let r=Ge(),a=()=>s(r.snapshot());return i.useSyncExternalStore(r.subscribe,a,a)}function Ns(s,r,a,l=[]){let o=i.useRef(),d=ge();return ae(()=>{var m;let t=(()=>{var c;for(let j of a){if(typeof j=="string")return j.trim();if(typeof j=="object"&&"current"in j)return j.current?(c=j.current.textContent)==null?void 0:c.trim():o.current}})(),y=l.map(c=>c.trim());d.value(s,t,y),(m=r.current)==null||m.setAttribute(ie,t),o.current=t}),o}var St=()=>{let[s,r]=i.useState(),a=le(()=>new Map);return ae(()=>{a.current.forEach(l=>l()),a.current=new Map},[s]),(l,o)=>{a.current.set(l,o),r({})}};function Tt(s){let r=s.type;return typeof r=="function"?r(s.props):"render"in r?r.render(s.props):s}function we({asChild:s,children:r},a){return s&&i.isValidElement(r)?i.cloneElement(Tt(r),{ref:r.ref},a(r.props.children)):a(r)}var Rt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ys=i.forwardRef(({className:s,...r},a)=>e.jsx(L,{ref:a,className:de("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...r}));ys.displayName=L.displayName;const bs=i.forwardRef(({className:s,...r},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(ns,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(L.Input,{ref:a,className:de("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...r})]}));bs.displayName=L.Input.displayName;const ks=i.forwardRef(({className:s,...r},a)=>e.jsx(L.List,{ref:a,className:de("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...r}));ks.displayName=L.List.displayName;const ws=i.forwardRef((s,r)=>e.jsx(L.Empty,{ref:r,className:"py-6 text-center text-sm",...s}));ws.displayName=L.Empty.displayName;const Cs=i.forwardRef(({className:s,...r},a)=>e.jsx(L.Group,{ref:a,className:de("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...r}));Cs.displayName=L.Group.displayName;const Et=i.forwardRef(({className:s,...r},a)=>e.jsx(L.Separator,{ref:a,className:de("-mx-1 h-px bg-border",s),...r}));Et.displayName=L.Separator.displayName;const Ss=i.forwardRef(({className:s,...r},a)=>e.jsx(L.Item,{ref:a,className:de("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s),...r}));Ss.displayName=L.Item.displayName;const At=Y.object({recipientId:Y.string().min(1,{message:"Please select a recipient"}),amount:Y.string().refine(s=>!isNaN(Number(s)),{message:"Amount must be a number"}).refine(s=>Number(s)>0,{message:"Amount must be greater than 0"}).refine(s=>Number(s)===Math.floor(Number(s)),{message:"Amount must be a whole number"}),notes:Y.string().max(100).optional()});function Pt(){const{toast:s}=Le(),[r,a]=i.useState(!1),[l,o]=i.useState(null),[d,m]=i.useState(!1),[t,y]=i.useState(""),{data:c,isLoading:j}=ye({queryKey:["/api/tokens"],refetchOnWindowFocus:!1}),{data:g,isLoading:C,refetch:f}=ye({queryKey:["/api/users/search",t],enabled:t.length>=2,queryFn:async()=>await(await Me("GET",`/api/users/search?q=${encodeURIComponent(t)}`)).json()}),k=rs({resolver:cs(At),defaultValues:{recipientId:"",amount:"",notes:""}});i.useEffect(()=>{l?k.setValue("recipientId",l.id.toString()):k.setValue("recipientId","")},[l,k]);const E=be({mutationFn:async x=>await(await Me("POST","/api/tokens/transfer",{recipientId:x.recipientId,amount:Number(x.amount),notes:x.notes})).json(),onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/tokens"]}),Q.invalidateQueries({queryKey:["/api/rewards/history"]}),s({title:"Tokens transferred successfully!",description:`You've sent ${k.getValues().amount} tokens to ${l==null?void 0:l.username}.`,variant:"default"}),k.reset(),o(null),a(!1)},onError:x=>{a(!1),s({title:"Transfer failed",description:x.message||"Failed to transfer tokens. Please try again.",variant:"destructive"})}}),q=x=>{if(!l){s({title:"No recipient selected",description:"Please select a user to send tokens to.",variant:"destructive"});return}const S=Number(x.amount);if(c&&S>c.tokens){s({title:"Insufficient tokens",description:`You only have ${c.tokens} tokens available.`,variant:"destructive"});return}a(!0)},H=()=>{E.mutate(k.getValues())},b=x=>{y(x),x.length>=2&&f()},z=x=>{o(x),m(!1)},P=x=>x.firstName&&x.lastName?`${x.firstName[0]}${x.lastName[0]}`.toUpperCase():x.username.substring(0,2).toUpperCase();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Transfer Tokens"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send tokens to other MoodSync users. This feature is exclusive to premium members."})]}),e.jsx($,{children:e.jsx(D,{className:"p-6",children:e.jsx(is,{...k,children:e.jsxs("form",{onSubmit:k.handleSubmit(q),className:"space-y-6",children:[e.jsx(_,{control:k.control,name:"recipientId",render:()=>e.jsxs(V,{className:"flex flex-col",children:[e.jsx(O,{children:"Recipient"}),e.jsxs(Ps,{open:d,onOpenChange:m,children:[e.jsx(Is,{asChild:!0,children:e.jsx(R,{variant:"outline",role:"combobox",className:"justify-start w-full",children:l?e.jsxs("div",{className:"flex items-center",children:[e.jsxs(Te,{className:"h-6 w-6 mr-2",children:[e.jsx(Re,{src:l.profilePicture}),e.jsx(Ee,{children:P(l)})]}),e.jsx("span",{children:l.username}),l.firstName&&l.lastName&&e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",l.firstName," ",l.lastName,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Search for a user"})]})})}),e.jsx(Fs,{className:"p-0 w-full min-w-[300px]",children:e.jsxs(ys,{children:[e.jsx(bs,{placeholder:"Search by username, name, or email",onValueChange:b,value:t}),e.jsxs(ks,{children:[C&&e.jsx("div",{className:"p-4 text-center text-sm",children:"Searching..."}),!C&&t.length<2&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Type at least 2 characters to search"}),!C&&t.length>=2&&e.jsx(ws,{children:"No users found"}),e.jsx(Cs,{children:g==null?void 0:g.map(x=>e.jsx(Ss,{onSelect:()=>z(x),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(Te,{className:"h-8 w-8 mr-2",children:[e.jsx(Re,{src:x.profilePicture}),e.jsx(Ee,{children:P(x)})]}),e.jsxs("div",{children:[e.jsx("div",{children:x.username}),x.firstName&&x.lastName&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.firstName," ",x.lastName]}),x.email&&e.jsx("div",{className:"text-xs text-muted-foreground",children:x.email})]})]})},x.id))})]})]})})]}),e.jsx(J,{})]})}),e.jsx(_,{control:k.control,name:"amount",render:({field:x})=>e.jsxs(V,{children:[e.jsx(O,{children:"Amount"}),e.jsx(G,{children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{placeholder:"Enter amount of tokens",...x,type:"number",min:"1",step:"1"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-muted-foreground",children:"tokens"})]})}),e.jsxs(ke,{className:"flex justify-between",children:[e.jsx("span",{children:"Minimum transfer: 10 tokens"}),e.jsxs("span",{children:["Balance: ",j?"...":(c==null?void 0:c.tokens)||0," tokens"]})]}),e.jsx(J,{})]})}),e.jsx(_,{control:k.control,name:"notes",render:({field:x})=>e.jsxs(V,{children:[e.jsx(O,{children:"Note (Optional)"}),e.jsx(G,{children:e.jsx(ls,{placeholder:"Add a personal note",className:"resize-none",...x})}),e.jsx(ke,{children:"This note will be visible to the recipient"}),e.jsx(J,{})]})}),e.jsxs(R,{type:"submit",className:"w-full",disabled:E.isPending,children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),E.isPending?"Transferring...":"Send Tokens"]})]})})})}),e.jsx(Be,{open:r,onOpenChange:a,children:e.jsxs(Ve,{children:[e.jsxs(Oe,{children:[e.jsx(Ue,{children:"Confirm Token Transfer"}),e.jsx(Ke,{children:"Please review and confirm your token transfer details."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-muted-foreground",children:"Recipient:"}),e.jsxs("div",{className:"font-medium flex items-center",children:[e.jsxs(Te,{className:"h-6 w-6 mr-2",children:[e.jsx(Re,{src:l==null?void 0:l.profilePicture}),e.jsx(Ee,{children:l?P(l):"NA"})]}),l==null?void 0:l.username]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("div",{className:"font-medium",children:[k.getValues().amount," tokens"]})]}),k.getValues().notes&&e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsx(fe,{className:"text-muted-foreground mb-2 block",children:"Note:"}),e.jsx("div",{className:"text-sm bg-muted p-3 rounded-md",children:k.getValues().notes})]}),e.jsxs("div",{className:"flex items-start mt-4 bg-yellow-50 dark:bg-yellow-950 p-3 rounded-md",children:[e.jsx(os,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500 mt-0.5 mr-2 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-yellow-800 dark:text-yellow-400",children:"This action cannot be undone. Once sent, the tokens will be immediately transferred to the recipient."})]})]}),e.jsxs(Ye,{children:[e.jsx(R,{variant:"outline",onClick:()=>a(!1),disabled:E.isPending,children:"Cancel"}),e.jsxs(R,{onClick:H,disabled:E.isPending,className:"ml-2",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),E.isPending?"Processing...":"Confirm Transfer"]})]})]})})]})}function It({milestone:s,isAchieved:r,currentTokens:a,title:l,description:o,className:d}){const[m,t]=i.useState(!1),[y,c]=i.useState(""),[j,g]=i.useState(!1),{toast:C}=Le(),f=r?`I've reached the ${s} tokens milestone on MoodSync! ${l}`:`I'm working toward the ${s} tokens milestone on MoodSync! ${Math.round(a/s*100)}% there so far!`,k=b=>{b&&(c(f),g(!1)),t(b)},E=`${window.location.origin}/milestones/${s}`,q=be({mutationFn:async b=>(await Me("POST","/api/milestone-shares",b)).json(),onSuccess:b=>{b.tokensAwarded>0&&C({title:"Token reward!",description:b.message,variant:"success"})},onError:b=>{C({title:"Share error",description:b instanceof Error?b.message:"Failed to record share",variant:"destructive"})}}),H=()=>{navigator.clipboard.writeText(E),g(!0),setTimeout(()=>g(!1),2e3);const b=es();q.mutate({platform:"copy_link",shareUrl:E,shareMessage:y,milestone:s,trackingId:b}),C({title:"Link copied!",description:"The milestone share link has been copied to your clipboard.",variant:"success"})};return e.jsx("div",{className:d,children:e.jsxs($,{className:"overflow-hidden border-gradient",children:[e.jsx(U,{className:"pb-2",children:e.jsx(K,{className:"text-lg font-medium",children:"Share Your Milestone"})}),e.jsxs(D,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Share your token milestone progress with friends and earn additional tokens!"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(Xs,{url:E,title:`${l} - MoodSync Milestone`,message:f,milestone:s}),e.jsxs(Be,{open:m,onOpenChange:k,children:[e.jsx(qs,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:"gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"Customize Share"]})}),e.jsxs(Ve,{className:"sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsx(Ue,{children:"Share Milestone"}),e.jsx(Ke,{children:"Customize your message before sharing your milestone."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(fe,{htmlFor:"message",children:"Share message"}),e.jsx(ls,{id:"message",value:y,onChange:b=>c(b.target.value),className:"resize-none",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(fe,{htmlFor:"link",children:"Link"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:"link",value:E,readOnly:!0,className:"flex-1"}),e.jsxs(R,{type:"button",size:"sm",className:"px-3",onClick:H,children:[j?e.jsx(Ds,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Copy link"})]})]})]})]}),e.jsx(Ye,{className:"flex flex-col sm:flex-row",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 w-full sm:w-auto",children:[{name:"twitter",icon:e.jsx(et,{className:"h-4 w-4"}),label:"Twitter"},{name:"facebook",icon:e.jsx(st,{className:"h-4 w-4"}),label:"Facebook"},{name:"linkedin",icon:e.jsx(tt,{className:"h-4 w-4"}),label:"LinkedIn"},{name:"whatsapp",icon:e.jsx(ds,{className:"h-4 w-4"}),label:"WhatsApp"}].map(b=>e.jsxs(R,{type:"button",variant:"outline",size:"sm",className:"flex flex-col items-center p-2 h-auto gap-1",onClick:()=>{const z=es();let P="";switch(b.name){case"twitter":P=`https://twitter.com/intent/tweet?text=${encodeURIComponent(y)}`;break;case"facebook":P=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;break;case"linkedin":P=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}&title=${encodeURIComponent(y)}`;break;case"whatsapp":P=`https://api.whatsapp.com/send?text=${encodeURIComponent(`${y} ${window.location.href}`)}`;break}q.mutate({platform:b.name,shareUrl:window.location.href,shareMessage:y,milestone:s,trackingId:z}),window.open(P,"_blank"),t(!1)},children:[b.icon,e.jsx("span",{className:"text-xs",children:b.label})]},b.name))})})]})]})]})]}),e.jsx(te,{className:"bg-gray-50 dark:bg-gray-800/50 p-3",children:e.jsx("div",{className:"text-xs text-gray-500 w-full text-center",children:r?"Share your achievement to earn tokens!":"Share your progress to earn tokens!"})})]})})}function Ft({tokensRedeemed:s,cashAmount:r,onDismiss:a}){const[l,o]=Ls();return e.jsxs($,{className:"w-full shadow-lg border-green-200 bg-gradient-to-b from-green-50 to-white",children:[e.jsxs(U,{className:"pb-4 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-green-100",children:e.jsx(He,{className:"h-10 w-10 text-green-600"})}),e.jsx(K,{className:"text-2xl",children:"Redemption Successful!"})]}),e.jsxs(D,{className:"text-center space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-600",children:"You've successfully redeemed"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[s," tokens"]}),e.jsx("p",{className:"text-gray-600",children:"for"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["$",r]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:[e.jsx("p",{children:"Your redemption has been submitted and is being processed."}),e.jsx("p",{children:"You'll receive a confirmation once it's completed."})]})]}),e.jsxs(te,{className:"flex flex-col space-y-3 pt-0",children:[e.jsx("div",{className:"w-full",children:e.jsx(It,{milestone:1e3,currentTokens:s,className:"w-full"})}),e.jsxs("div",{className:"flex space-x-3 w-full",children:[e.jsx(R,{variant:"outline",className:"flex-1",onClick:()=>o("/milestones"),children:"View Milestones"}),e.jsx(R,{variant:"default",className:"flex-1",onClick:a,children:"Back to Redemption"})]})]})]})}const Mt=Y.object({tokensRedeemed:Y.string().min(1,"Token amount is required").refine(s=>!isNaN(Number(s)),"Must be a valid number").refine(s=>Number(s)>0,"Token amount must be greater than 0"),cashAmount:Y.string(),redemptionType:Y.enum(["cash","donation","transfer"]),recipientInfo:Y.string().optional(),currency:Y.string().default("USD"),notes:Y.string().optional()});function qt(){const[s,r]=i.useState("redeem"),[a,l]=i.useState(!1),[o,d]=i.useState({tokensRedeemed:0,cashAmount:"0.00"}),{toast:m}=Le(),{data:t,isLoading:y,error:c}=ye({queryKey:["/api/token-redemption/eligibility"],refetchOnWindowFocus:!1}),{data:j,isLoading:g,error:C}=ye({queryKey:["/api/token-redemption/history"],refetchOnWindowFocus:!1}),f=rs({resolver:cs(Mt),defaultValues:{tokensRedeemed:"",cashAmount:"0.00",redemptionType:"cash",recipientInfo:"",currency:"USD",notes:""}});i.useEffect(()=>{const u=f.watch(v=>{if(t&&v.tokensRedeemed&&!isNaN(Number(v.tokensRedeemed))){const I=(Number(v.tokensRedeemed)*.001).toFixed(2);f.setValue("cashAmount",I)}});return()=>u.unsubscribe()},[f,t]);const k=be({mutationFn:async u=>{const v=await fetch("/api/token-redemption/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!v.ok){try{const A=v.headers.get("content-type");if(A&&A.includes("application/json")){const I=await v.json();if(I.message)throw new Error(I.message);if(I.error)throw new Error(I.error)}if(v.status===400)throw new Error("Please check your redemption information and try again.");if(v.status===401)throw new Error("You need to be logged in to redeem tokens.");if(v.status===403)throw new Error("You don't have permission to perform this action.");if(v.status===429)throw new Error("Too many requests. Please wait before trying again.");if(v.status>=500)throw new Error("Our token system is temporarily unavailable. Please try again later.")}catch(A){if(A instanceof Error)throw A}throw new Error("Failed to create redemption request. Please try again later.")}return v.json()},onSuccess:(u,v)=>{d({tokensRedeemed:Number(v.tokensRedeemed),cashAmount:v.cashAmount}),l(!0),f.reset(),Q.invalidateQueries({queryKey:["/api/token-redemption/eligibility"]}),Q.invalidateQueries({queryKey:["/api/token-redemption/history"]})},onError:u=>{m({title:"Redemption Request Failed",description:u.message,variant:"destructive"})}}),E=be({mutationFn:async u=>{const v=await fetch(`/api/token-redemption/${u}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!v.ok){try{const A=v.headers.get("content-type");if(A&&A.includes("application/json")){const I=await v.json();if(I.message)throw new Error(I.message);if(I.error)throw new Error(I.error)}if(v.status===400)throw new Error("This request cannot be canceled at this time.");if(v.status===401)throw new Error("You need to be logged in to cancel a request.");if(v.status===403)throw new Error("You don't have permission to cancel this request.");if(v.status===404)throw new Error("The request you're trying to cancel could not be found.");if(v.status>=500)throw new Error("Our system is temporarily unavailable. Please try again later.")}catch(A){if(A instanceof Error)throw A}throw new Error("Unable to cancel the redemption request. Please try again or contact support.")}return v.json()},onSuccess:()=>{m({title:"Redemption Canceled",description:"Your token redemption request has been canceled successfully."}),Q.invalidateQueries({queryKey:["/api/token-redemption/eligibility"]}),Q.invalidateQueries({queryKey:["/api/token-redemption/history"]})},onError:u=>{m({title:"Cancellation Failed",description:u.message,variant:"destructive"})}}),q=u=>{if(!(t!=null&&t.eligible)){m({title:"Not Eligible",description:`You need at least ${(t==null?void 0:t.minimumTokens)||1e4} tokens to redeem.`,variant:"destructive"});return}if(Number(u.tokensRedeemed)>t.tokenBalance){m({title:"Insufficient Tokens",description:`You only have ${t.tokenBalance} tokens available.`,variant:"destructive"});return}k.mutate(u)},[H,b]=i.useState(!1),[z,P]=i.useState(null),x=u=>{P(u),b(!0)},S=()=>{z!==null&&(E.mutate(z),b(!1),P(null))},F=()=>{b(!1),P(null)},me=u=>{switch(u){case"pending":return e.jsx(re,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"});case"processing":return e.jsx(re,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Processing"});case"completed":return e.jsx(re,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Completed"});case"failed":return e.jsx(re,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:"Failed"});case"canceled":return e.jsx(re,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:"Canceled"});default:return e.jsx(re,{variant:"outline",children:u})}};if(y)return e.jsx("div",{className:"flex items-center justify-center h-52",children:e.jsx(he,{className:"w-8 h-8 animate-spin text-primary"})});const{user:ne}=ms(),W=(ne==null?void 0:ne.isPremium)||!1,ue=()=>{l(!1)};return a?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsx(Ft,{tokensRedeemed:o.tokensRedeemed,cashAmount:o.cashAmount,onDismiss:ue})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Be,{open:H,onOpenChange:b,children:e.jsxs(Ve,{className:"sm:max-w-md",children:[e.jsxs(Oe,{children:[e.jsxs(Ue,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-amber-500"}),"Cancel Redemption Request"]}),e.jsx(Ke,{children:"Are you sure you want to cancel this token redemption request? This action cannot be undone."})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md text-sm",children:[e.jsx("p",{children:"When you cancel a redemption request:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[e.jsx("li",{children:"Your tokens will be returned to your balance immediately"}),e.jsx("li",{children:"The request will be marked as canceled in your history"}),e.jsx("li",{children:"You can create a new redemption request at any time"})]})]}),e.jsxs(Ye,{className:"flex sm:justify-between",children:[e.jsx(R,{type:"button",variant:"outline",onClick:F,children:"Keep Request"}),e.jsxs(R,{type:"button",variant:"destructive",onClick:S,disabled:E.isPending,children:[E.isPending&&e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Yes, Cancel Request"]})]})]})}),e.jsxs(ze,{defaultValue:s,onValueChange:r,className:"w-full",children:[e.jsxs(We,{className:"grid w-full grid-cols-4",children:[e.jsx(X,{value:"redeem",children:"Redeem Tokens"}),e.jsx(X,{value:"premium-access",disabled:W,children:e.jsxs("div",{className:"flex items-center",children:[W&&e.jsx("span",{className:"mr-1.5 text-xs bg-amber-200 dark:bg-amber-800 text-amber-800 dark:text-amber-200 py-0.5 px-1.5 rounded-sm",children:"Available"}),"Premium Access"]})}),e.jsx(X,{value:"transfer",disabled:!W,children:e.jsxs("div",{className:"flex items-center",children:[!W&&e.jsx("span",{className:"mr-1.5 text-xs bg-amber-200 dark:bg-amber-800 text-amber-800 dark:text-amber-200 py-0.5 px-1.5 rounded-sm",children:"Premium"}),"Transfer Tokens"]})}),e.jsx(X,{value:"history",children:"History"})]}),e.jsx(Z,{value:"premium-access",className:"space-y-4 pt-4",children:W?e.jsx($,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center space-y-4",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/40 p-3 rounded-full",children:e.jsx(He,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"You Already Have Premium Access"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"You're already enjoying all the premium features with your current subscription. There's no need to redeem tokens for premium access."})]})})}):e.jsxs($,{children:[e.jsxs(U,{children:[e.jsx(K,{children:"Premium Access with Tokens"}),e.jsx(pe,{children:"Use tokens to temporarily upgrade to premium features"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"How It Works"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:"Redeem your earned tokens for temporary access to all premium features without a subscription. The more tokens you use, the longer your premium access duration."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs($,{className:"bg-gradient-to-b from-card/80 to-card hover:shadow-md transition-shadow border-primary/20",children:[e.jsx(U,{className:"pb-2",children:e.jsx(K,{className:"text-lg",children:"1 Week Access"})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-3xl font-bold text-primary mb-1",children:"2,500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"tokens"})]}),e.jsx(te,{children:e.jsx(R,{variant:t&&t.tokenBalance>=2500?"default":"outline",className:"w-full",disabled:!t||t.tokenBalance<2500,children:t&&t.tokenBalance>=2500?"Redeem Now":"Not Enough Tokens"})})]}),e.jsxs($,{className:"bg-gradient-to-b from-card/80 to-card hover:shadow-md transition-shadow border-primary/20",children:[e.jsx(U,{className:"pb-2",children:e.jsx(K,{className:"text-lg",children:"2 Weeks Access"})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-3xl font-bold text-primary mb-1",children:"4,500"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"tokens"})]}),e.jsx(te,{children:e.jsx(R,{variant:t&&t.tokenBalance>=4500?"default":"outline",className:"w-full",disabled:!t||t.tokenBalance<4500,children:t&&t.tokenBalance>=4500?"Redeem Now":"Not Enough Tokens"})})]}),e.jsxs($,{className:"bg-gradient-to-b from-card/80 to-card hover:shadow-md transition-shadow border-primary/20",children:[e.jsx(U,{className:"pb-2",children:e.jsx(K,{className:"text-lg",children:"3 Weeks Access"})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-3xl font-bold text-primary mb-1",children:"7,000"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"tokens"})]}),e.jsx(te,{children:e.jsx(R,{variant:t&&t.tokenBalance>=7e3?"default":"outline",className:"w-full",disabled:!t||t.tokenBalance<7e3,children:t&&t.tokenBalance>=7e3?"Redeem Now":"Not Enough Tokens"})})]}),e.jsxs($,{className:"bg-gradient-to-b from-card/80 to-card hover:shadow-md transition-shadow border-primary/20",children:[e.jsx(U,{className:"pb-2",children:e.jsx(K,{className:"text-lg",children:"4 Weeks Access"})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-3xl font-bold text-primary mb-1",children:"10,000"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"tokens"})]}),e.jsx(te,{children:e.jsx(R,{variant:t&&t.tokenBalance>=1e4?"default":"outline",className:"w-full",disabled:!t||t.tokenBalance<1e4,children:t&&t.tokenBalance>=1e4?"Redeem Now":"Not Enough Tokens"})})]})]}),e.jsx("div",{className:"bg-muted/30 p-4 rounded-lg mt-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Your token balance: ",(t==null?void 0:t.tokenBalance)||0," tokens"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Continue using MoodSync and completing challenges to earn more tokens!"})]})]})})]})]})}),e.jsx(Z,{value:"transfer",className:"space-y-4 pt-4",children:W?e.jsx(Pt,{}):e.jsx($,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center space-y-4",children:[e.jsx("div",{className:"bg-amber-100 dark:bg-amber-900/40 p-3 rounded-full",children:e.jsx(us,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"Premium Feature"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"Token transfers are available exclusively to premium members. Upgrade to premium to send tokens to friends and family!"}),e.jsx(R,{className:"mt-2",variant:"default",children:"Upgrade to Premium"})]})})})}),e.jsx(Z,{value:"redeem",className:"space-y-4 pt-4",children:e.jsxs($,{children:[e.jsxs(U,{children:[e.jsx(K,{children:"Your Token Balance"}),e.jsx(pe,{children:"Redeem your tokens for real-world value"})]}),e.jsx(D,{className:"space-y-4",children:c?e.jsxs("div",{className:"text-center py-6 space-y-4",children:[e.jsx(Ne,{className:"h-10 w-10 mx-auto text-destructive"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Unable to Load Token Information"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto mb-4",children:c instanceof Error&&!c.message.includes("TypeError")&&!c.message.includes("undefined")?c.message:"We're having trouble connecting to our token system. This might be due to a temporary connection issue."}),e.jsx(R,{onClick:()=>Q.invalidateQueries({queryKey:["/api/token-redemption/eligibility"]}),children:"Try Again"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:(t==null?void 0:t.tokenBalance.toLocaleString())||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Available Tokens"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-primary",children:["$",(((t==null?void 0:t.tokenBalance)||0)*.001).toFixed(2)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Estimated Value ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"($0.0010 per token)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress to Redemption Goal"}),e.jsxs("span",{className:"font-medium",children:[(t==null?void 0:t.tokenBalance)||0,"/10000 tokens (",Math.min(100,Math.floor(((t==null?void 0:t.tokenBalance)||0)/1e4*100)),"%)"]})]}),e.jsx(Bs,{value:Math.min(100,((t==null?void 0:t.tokenBalance)||0)/1e4*100),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10000"})]})]}),(t==null?void 0:t.eligible)&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(R,{className:"w-full sm:w-auto",onClick:()=>{f.setValue("tokensRedeemed","10000"),f.setValue("cashAmount",(1e4*.001).toFixed(2)),r("redeem"),setTimeout(()=>{var v;(v=document.getElementById("redemption-form"))==null||v.scrollIntoView({behavior:"smooth"})},100)},children:[e.jsx(Vs,{className:"mr-2 h-4 w-4"}),"Redeem 10000 Tokens Now"]})}),!(t!=null&&t.eligible)&&e.jsxs(Qs,{children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(_s,{children:"Not Eligible"}),e.jsx(Js,{children:"You need at least 10000 tokens to redeem. Keep earning to reach the minimum!"})]}),(t==null?void 0:t.eligible)&&e.jsx(is,{...f,children:e.jsxs("form",{id:"redemption-form",onSubmit:f.handleSubmit(q),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(_,{control:f.control,name:"tokensRedeemed",render:({field:u})=>e.jsxs(V,{children:[e.jsx(O,{children:"Tokens to Redeem"}),e.jsx(G,{children:e.jsx(oe,{type:"number",placeholder:"Enter amount of tokens",...u,min:t.minimumTokens,max:t.tokenBalance})}),e.jsx(ke,{children:"Minimum: 10000 tokens"}),e.jsx(J,{})]})}),e.jsx(_,{control:f.control,name:"cashAmount",render:({field:u})=>e.jsxs(V,{children:[e.jsx(O,{children:"Estimated Value"}),e.jsx(G,{children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-input bg-muted text-muted-foreground text-sm",children:"$"}),e.jsx(oe,{className:"rounded-l-none",...u,disabled:!0})]})}),e.jsx(ke,{children:"Rate: $0.0010 per token"}),e.jsx(J,{})]})})]}),e.jsx(_,{control:f.control,name:"redemptionType",render:({field:u})=>e.jsxs(V,{className:"space-y-3",children:[e.jsx(O,{children:"Redemption Type"}),e.jsx(G,{children:e.jsxs(at,{onValueChange:u.onChange,defaultValue:u.value,className:"flex flex-col space-y-1",children:[e.jsxs(V,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(G,{children:e.jsx(Ae,{value:"cash"})}),e.jsx(O,{className:"font-normal",children:"Cash Payout"})]}),e.jsxs(V,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(G,{children:e.jsx(Ae,{value:"donation"})}),e.jsx(O,{className:"font-normal",children:"Donate to Charity"})]}),e.jsxs(V,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(G,{children:e.jsx(Ae,{value:"transfer"})}),e.jsx(O,{className:"font-normal",children:"Transfer to Another User"})]})]})}),e.jsx(J,{})]})}),f.watch("redemptionType")!=="cash"&&e.jsx(_,{control:f.control,name:"recipientInfo",render:({field:u})=>e.jsxs(V,{children:[e.jsx(O,{children:f.watch("redemptionType")==="donation"?"Charity Information":"Recipient Username"}),e.jsx(G,{children:e.jsx(oe,{placeholder:f.watch("redemptionType")==="donation"?"Enter charity name":"Enter recipient username",...u})}),e.jsx(J,{})]})}),e.jsx(_,{control:f.control,name:"notes",render:({field:u})=>e.jsxs(V,{children:[e.jsx(O,{children:"Notes (Optional)"}),e.jsx(G,{children:e.jsx(oe,{placeholder:"Add any additional information",...u})}),e.jsx(J,{})]})}),e.jsxs(R,{type:"submit",className:"w-full",disabled:k.isPending,children:[k.isPending&&e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Redemption Request"]})]})})]})})]})}),e.jsx(Z,{value:"history",className:"pt-4",children:e.jsxs($,{children:[e.jsxs(U,{children:[e.jsx(K,{children:"Redemption History"}),e.jsx(pe,{children:"Track your token redemption requests"})]}),e.jsx(D,{children:g?e.jsx("div",{className:"flex items-center justify-center h-52",children:e.jsx(he,{className:"w-8 h-8 animate-spin text-primary"})}):C?e.jsxs("div",{className:"text-center py-6 space-y-4",children:[e.jsx(Ne,{className:"h-10 w-10 mx-auto text-destructive"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Unable to Load Redemption History"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto mb-4",children:C instanceof Error&&!C.message.includes("TypeError")&&!C.message.includes("undefined")?C.message:"We're having trouble connecting to our transaction system. This might be due to a temporary connection issue."}),e.jsx(R,{onClick:()=>Q.invalidateQueries({queryKey:["/api/token-redemption/history"]}),children:"Try Again"})]})]}):e.jsx("div",{className:"space-y-4",children:j&&j.length>0?j.map(u=>e.jsxs($,{className:"bg-muted/30",children:[e.jsx(U,{className:"p-4 pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"text-base",children:[u.tokensRedeemed," Tokens",e.jsxs("span",{className:"ml-2 text-sm font-normal text-muted-foreground",children:["($",u.cashAmount,")"]})]}),e.jsxs(pe,{children:[new Date(u.createdAt).toLocaleDateString()," at ",new Date(u.createdAt).toLocaleTimeString()]})]}),e.jsx("div",{children:me(u.status)})]})}),e.jsx(D,{className:"p-4 pt-0 pb-2",children:e.jsx("div",{className:"text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Type:"}),e.jsx("div",{className:"font-medium capitalize",children:u.redemptionType}),u.recipientInfo&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-muted-foreground",children:"Recipient:"}),e.jsx("div",{className:"font-medium",children:u.recipientInfo})]}),u.processedAt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-muted-foreground",children:"Processed Date:"}),e.jsx("div",{className:"font-medium",children:new Date(u.processedAt).toLocaleDateString()})]}),u.notes&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-muted-foreground",children:"Notes:"}),e.jsx("div",{className:"font-medium",children:u.notes})]})]})})}),u.status==="pending"&&e.jsx(te,{className:"p-4 pt-2",children:e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>x(u.id),disabled:E.isPending,children:[E.isPending&&e.jsx(he,{className:"mr-2 h-3 w-3 animate-spin"}),"Cancel Request"]})})]},u.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(Os,{className:"h-6 w-6"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No redemption history"}),e.jsx("p",{className:"text-sm max-w-md mx-auto",children:"You haven't made any token redemption requests yet. Start redeeming your tokens today!"}),e.jsxs(R,{variant:"link",onClick:()=>r("redeem"),className:"mt-2",children:["Redeem Tokens ",e.jsx(Us,{className:"ml-1 h-4 w-4"})]})]})})})]})})]})]})}function $t(){const[s,r]=i.useState("earning"),a=[{title:"Daily Activities",description:"Earn tokens by maintaining your daily emotional wellness routine",icon:e.jsx(Ks,{className:"h-5 w-5 text-orange-500"}),activities:[{name:"Daily Check-in",tokens:.25,description:"Update your emotional state once per day"},{name:"Journal Entry",tokens:.5,description:"Create a journal entry about your feelings (once per day)"},{name:"Streak Bonus",tokens:.75,description:"Additional tokens for maintaining a 7+ day streak"}]},{title:"Community Participation",description:"Earn tokens by connecting with others and building community",icon:e.jsx(ds,{className:"h-5 w-5 text-blue-500"}),activities:[{name:"Chat Participation",tokens:.5,description:"Participate in emotion-based chat rooms"},{name:"Help Others",tokens:.5,description:"Provide support to users with similar emotions"}]},{title:"Challenges",description:"Complete challenges to earn tokens based on difficulty",icon:e.jsx(Ys,{className:"h-5 w-5 text-purple-500"}),activities:[{name:"Easy Challenge",tokens:.5,description:"Complete basic emotional wellness challenges"},{name:"Moderate Challenge",tokens:.75,description:"Complete intermediate challenges requiring more effort"},{name:"Hard Challenge",tokens:1.25,description:"Complete difficult challenges requiring dedication"},{name:"Extreme Challenge",tokens:1.75,description:"Complete the most demanding emotional growth challenges"}]},{title:"Growth & Achievements",description:"Earn tokens by achieving personal growth milestones",icon:e.jsx(Hs,{className:"h-5 w-5 text-green-500"}),activities:[{name:"Badge Earned",tokens:.5,description:"Earn special badges for milestone achievements"},{name:"Level Up",tokens:1.25,description:"Reach a new level in your emotional wellness journey"}]}],l=[{title:"Cash Redemption",description:"Convert your tokens to real money",icon:e.jsx(Ze,{className:"h-5 w-5 text-amber-500"}),details:["Minimum 10000 tokens required for redemption","Current conversion rate: $0.0010 per token","Processing time: 3-5 business days","Available payment methods: PayPal and Stripe"]},{title:"Charitable Donations",description:"Use your tokens to support mental health charities",icon:e.jsx(nt,{className:"h-5 w-5 text-red-500"}),details:["Donate to partner mental health organizations","Same conversion rate as cash redemptions","Receive a donation receipt for tax purposes","100% of the value goes directly to the charity"]},{title:"Premium Features",description:"Use tokens to unlock premium features temporarily",icon:e.jsx(zs,{className:"h-5 w-5 text-violet-500"}),details:["Access premium features without a subscription","2500 tokens = 1 week of premium access","4500 tokens = 2 weeks of premium access","7000 tokens = 3 weeks of premium access","10000 tokens = 4 weeks of premium access","No recurring charges or automatic renewals"]},{title:"Token Transfers",description:"Send tokens to friends and family",icon:e.jsx(us,{className:"h-5 w-5 text-emerald-500"}),details:["Transfer tokens to other MoodSync users","Minimum transfer amount: 10000 tokens","No fees for token transfers","Include a personalized message with your transfer"]}];return e.jsxs($,{children:[e.jsxs(U,{children:[e.jsx(K,{children:"Token System Guide"}),e.jsx(pe,{children:"Learn how to earn and redeem tokens in the MoodSync platform"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs(ze,{defaultValue:s,onValueChange:r,children:[e.jsxs(We,{className:"grid w-full grid-cols-2",children:[e.jsx(X,{value:"earning",children:"Earning Tokens"}),e.jsx(X,{value:"redemption",children:"Redemption Options"})]}),e.jsxs(Z,{value:"earning",className:"space-y-6 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"MoodSync rewards your engagement and commitment to emotional wellness. Here are all the ways you can earn tokens on the platform:"}),a.map((o,d)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 p-1.5 rounded-md bg-muted/50",children:o.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium",children:o.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.description})]})]}),e.jsx("div",{className:"ml-10 grid gap-2",children:o.activities.map((m,t)=>e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-center bg-muted/30 p-3 rounded-md",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:m.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m.description})]}),e.jsxs("div",{className:"flex items-center bg-primary/10 text-primary rounded-full px-3 py-1 text-sm font-medium",children:["+",m.tokens," ",e.jsx(Ze,{className:"ml-1 h-3.5 w-3.5"})]})]},t))}),d<a.length-1&&e.jsx(qe,{className:"my-4"})]},d)),e.jsxs("div",{className:"bg-muted/40 p-4 rounded-lg mt-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Important Note"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Token rewards for daily activities (check-ins, journal entries) can only be earned once per day. Streaks are calculated based on consecutive days of engagement. Missing a day will reset your streak."})]})]}),e.jsxs(Z,{value:"redemption",className:"space-y-6 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Turn your earned tokens into real-world value. Here are the ways you can redeem your tokens:"}),l.map((o,d)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 p-1.5 rounded-md bg-muted/50",children:o.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium",children:o.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.description})]})]}),e.jsx("div",{className:"ml-10",children:e.jsx("ul",{className:"space-y-2",children:o.details.map((m,t)=>e.jsxs("li",{className:"text-sm flex items-start",children:[e.jsx("span",{className:"mr-2 bg-primary rounded-full w-1.5 h-1.5 mt-1.5 flex-shrink-0"}),m]},t))})}),d<l.length-1&&e.jsx(qe,{className:"my-4"})]},d)),e.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20 mb-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Cash Redemption Examples"}),e.jsxs("div",{className:"text-xs text-muted-foreground grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"flex flex-col p-2 bg-background/50 rounded",children:[e.jsx("span",{className:"font-medium",children:"10,000 tokens"}),e.jsx("span",{className:"text-primary font-medium",children:"$10.00"})]}),e.jsxs("div",{className:"flex flex-col p-2 bg-background/50 rounded",children:[e.jsx("span",{className:"font-medium",children:"20,000 tokens"}),e.jsx("span",{className:"text-primary font-medium",children:"$20.00"})]}),e.jsxs("div",{className:"flex flex-col p-2 bg-background/50 rounded",children:[e.jsx("span",{className:"font-medium",children:"50,000 tokens"}),e.jsx("span",{className:"text-primary font-medium",children:"$50.00"})]})]})]}),e.jsxs("div",{className:"bg-muted/40 p-4 rounded-lg mt-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Redemption Policy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All redemption requests are reviewed for security purposes. Cash redemptions require identity verification for amounts over $50. Token values and conversion rates are subject to change. Any changes will be communicated at least 14 days in advance."})]})]})]})})]})}function zt(){ms();const[s,r]=i.useState("redeem");return e.jsxs("div",{className:"container max-w-6xl py-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Token Redemption Center"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Convert your earned tokens into real-world value"})]}),e.jsx(R,{variant:"outline",asChild:!0,className:"w-full sm:w-auto",children:e.jsxs(Ws,{to:"/token-guide",className:"flex items-center",children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Token System Guide"]})})]}),e.jsx(qe,{}),e.jsxs(ze,{defaultValue:s,onValueChange:r,className:"w-full",children:[e.jsxs(We,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(X,{value:"redeem",children:"Redeem Tokens"}),e.jsx(X,{value:"info",children:"How It Works"})]}),e.jsx(Z,{value:"redeem",className:"pt-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(qt,{})})}),e.jsx(Z,{value:"info",className:"pt-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx($t,{})})})]})]})}export{zt as default};
