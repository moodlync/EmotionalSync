import{a as C,r as n,Y as L,j as e,k,B as I,b9 as q,aE as E,I as F,G as j,H as g,J as f,K as N,M as l,aJ as R,aK as P,aL as U,aM as V,aN as $,V as z}from"./index-FJB1i4HR.js";import{A as m}from"./admin-layout-8bamUuof.js";import"./log-out-BnUgBTG3.js";import"./rotate-ccw-DBn94ek4.js";import"./quote-B2rQvQyw.js";import"./database-rNbYySWX.js";const B=["login","user_ban","user_unban","content_removal","warning_issued","payment_processed","refund_processed","account_recovery","challenge_approval","support_response","create_admin","update_admin","update_ticket","quote_created","quote_updated"];function O(){C();const[t,v]=n.useState(""),[c,y]=n.useState(""),[i,b]=n.useState("all"),[a,x]=n.useState(null),{data:h,isLoading:A,error:d,refetch:_}=L({queryKey:["/api/admin/actions"],queryFn:async()=>{const s=await z("GET","/api/admin/actions");if(!s.ok)throw new Error("Failed to fetch admin actions");return s.json()}}),p=h?h.filter(s=>{const T=t===""||s.actionType.toLowerCase().includes(t.toLowerCase())||s.actionDetails&&s.actionDetails.toLowerCase().includes(t.toLowerCase())||s.reason&&s.reason.toLowerCase().includes(t.toLowerCase())||s.adminId.toString().includes(t)||s.targetId&&s.targetId.toString().includes(t),w=c===""||s.actionType===c;let r=!0;if(i!=="all"){const D=new Date,S=new Date(s.createdAt),o=(D.getTime()-S.getTime())/(1e3*60*60);switch(i){case"24h":r=o<=24;break;case"7d":r=o<=24*7;break;case"30d":r=o<=24*30;break}}return T&&w&&r}):[],u=s=>{switch(s){case"login":return"bg-blue-100 text-blue-800";case"user_ban":case"content_removal":return"bg-red-100 text-red-800";case"user_unban":case"account_recovery":return"bg-green-100 text-green-800";case"payment_processed":case"refund_processed":return"bg-amber-100 text-amber-800";case"warning_issued":return"bg-orange-100 text-orange-800";case"support_response":case"update_ticket":return"bg-purple-100 text-purple-800";case"challenge_approval":return"bg-indigo-100 text-indigo-800";case"create_admin":case"update_admin":return"bg-teal-100 text-teal-800";case"quote_created":case"quote_updated":return"bg-cyan-100 text-cyan-800";default:return"bg-gray-100 text-gray-800"}};return A?e.jsx(m,{children:e.jsx("div",{className:"flex justify-center items-center h-[80vh]",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})})}):d?e.jsx(m,{children:e.jsxs("div",{className:"rounded-lg border border-destructive p-4 text-destructive",children:[e.jsx("p",{children:"Error loading admin actions"}),e.jsx("p",{className:"text-sm",children:d instanceof Error?d.message:"Unknown error"})]})}):e.jsxs(m,{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Actions Log"}),e.jsx("p",{className:"text-muted-foreground",children:"Track all administrative activities on MoodSync"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>_(),className:"h-8 gap-1",children:[e.jsx(q,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{type:"search",placeholder:"Search actions...",className:"pl-8",value:t,onChange:s=>v(s.target.value)})]}),e.jsx("div",{children:e.jsxs(j,{value:c,onValueChange:y,children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All action types"})}),e.jsxs(N,{children:[e.jsx(l,{value:"",children:"All action types"}),B.map(s=>e.jsx(l,{value:s,children:e.jsx("span",{className:"capitalize",children:s.replace(/_/g," ")})},s))]})]})}),e.jsx("div",{children:e.jsxs(j,{value:i,onValueChange:b,children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All time periods"})}),e.jsxs(N,{children:[e.jsx(l,{value:"all",children:"All time"}),e.jsx(l,{value:"24h",children:"Last 24 hours"}),e.jsx(l,{value:"7d",children:"Last 7 days"}),e.jsx(l,{value:"30d",children:"Last 30 days"})]})]})})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-muted/50",children:e.jsxs("div",{className:"grid grid-cols-9 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-medium",children:"Admin"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"font-medium",children:"Action"})}),e.jsx("div",{className:"col-span-3 hidden md:block",children:e.jsx("span",{className:"font-medium",children:"Details"})}),e.jsx("div",{className:"col-span-2 text-right",children:e.jsx("span",{className:"font-medium",children:"Timestamp"})})]})}),e.jsx("div",{className:"divide-y",children:p.length>0?p.map(s=>e.jsx("div",{className:"px-4 py-3 hover:bg-muted/50 cursor-pointer",onClick:()=>x(s),children:e.jsxs("div",{className:"grid grid-cols-9 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"font-medium",children:["Admin #",s.adminId]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["IP: ",s.ipAddress||"Unknown"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs ${u(s.actionType)}`,children:s.actionType.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.targetType&&e.jsxs("span",{children:[s.targetType," ",s.targetId&&`#${s.targetId}`]})})]}),e.jsx("div",{className:"col-span-3 hidden md:block",children:e.jsx("div",{className:"text-sm line-clamp-2",children:s.actionDetails||s.reason||"No details provided"})}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx("div",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString()})]})]})},s.id)):e.jsx("div",{className:"px-4 py-8 text-center text-muted-foreground",children:"No admin actions found"})})]})]}),e.jsx(R,{open:!!a,onOpenChange:s=>!s&&x(null),children:e.jsxs(P,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Admin Action Details"}),e.jsx($,{children:"Complete information about this administrative action"})]}),a&&e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Action Type"}),e.jsx("p",{className:"text-sm",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs ${u(a.actionType)}`,children:a.actionType.replace(/_/g," ")})})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Performed By"}),e.jsxs("p",{className:"text-sm",children:["Admin #",a.adminId]})]}),a.targetType&&e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Target"}),e.jsxs("p",{className:"text-sm capitalize",children:[a.targetType," ",a.targetId&&`#${a.targetId}`]})]}),a.actionDetails&&e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Details"}),e.jsx("p",{className:"text-sm",children:a.actionDetails})]}),a.reason&&e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Reason"}),e.jsx("p",{className:"text-sm",children:a.reason})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Date & Time"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"IP Address"}),e.jsx("p",{className:"text-sm",children:a.ipAddress||"Unknown"})]}),a.userAgent&&e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx("h3",{className:"text-sm font-medium",children:"User Agent"}),e.jsx("p",{className:"text-sm text-muted-foreground text-xs",children:a.userAgent})]})]})]})})]})}export{O as default};
