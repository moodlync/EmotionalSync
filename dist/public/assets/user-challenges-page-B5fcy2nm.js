import{c as W,u as K,a as H,m as z,r as x,b as Z,j as e,C as h,d as _,e as J,o as D,f as X,w as y,g as u,B as g,A as ee,h as se,i as ae,P as te,x as re,bw as le,U as P,O as ie,s as ne,k as L,H as k,t as ce,n as U,S as de,y as oe,z as me,D as F,ai as xe,I as he,aZ as V,a_ as I,a$ as B,b0 as M,b1 as Q,F as R,Q as ue}from"./index-vCbmY8Kg.js";import{C as Y}from"./challenge-creator-CJ0joKJd.js";import{C as ge}from"./circle-plus-90ZfNcQg.js";import"./checkbox-CA5cOVt_.js";import"./save-B1zrG4Dq.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=W("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function q({challenge:s,userProgress:d=0}){const{user:N}=K(),{toast:n}=H(),j=z(),[r,w]=x.useState(!1),o=Math.min(100,Math.round(d/s.targetValue*100)),l=d>=s.targetValue,m=Z({mutationFn:async()=>await ce("POST",`/api/challenges/${s.id}/progress`,{}),onSuccess:()=>{n({title:l?"Challenge Completed!":"Progress Recorded",description:l?"Congratulations! You've completed this challenge and earned a token.":"Your progress has been updated. Keep going!"}),j.invalidateQueries({queryKey:["/api/gamification/challenges"]}),j.invalidateQueries({queryKey:["/api/tokens"]})},onError:t=>{n({title:"Failed to Record Progress",description:t.message||"There was an error recording your progress. Please try again.",variant:"destructive"})}}),v=t=>{switch(t){case"easy":return"bg-green-100 text-green-800";case"moderate":return"bg-blue-100 text-blue-800";case"hard":return"bg-orange-100 text-orange-800";case"extreme":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},b=(t="")=>t.split(" ").map(i=>i[0]).join("").toUpperCase(),S=t=>t?t.split(",").map(i=>i.trim()).filter(Boolean):[];return e.jsxs(h,{className:l?"border-green-200 bg-green-50":void 0,children:[e.jsx(_,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(J,{className:"flex items-center",children:[l&&e.jsx(D,{className:"h-5 w-5 text-green-500 mr-2"}),s.title]}),e.jsx(X,{className:"mt-1",children:s.category.charAt(0).toUpperCase()+s.category.slice(1)})]}),e.jsx(y,{variant:"outline",className:`${v(s.difficulty)}`,children:s.difficulty.charAt(0).toUpperCase()+s.difficulty.slice(1)})]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[r?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}):e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsx(g,{variant:"link",size:"sm",className:"p-0 h-auto text-xs text-muted-foreground",onClick:()=>w(!r),children:r?"Show less":"Show more"}),s.createdBy&&e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsxs(ee,{className:"h-6 w-6 mr-2",children:[e.jsx(se,{src:""}),e.jsx(ae,{className:"text-xs",children:b(s.createdBy.toString())})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Created by a premium member"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[d," / ",s.targetValue]})]}),e.jsx(te,{value:o,className:"h-2"})]}),r&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(re,{className:"h-3.5 w-3.5 mr-1.5 text-amber-500"}),e.jsxs("span",{children:[s.tokenReward," token reward"]})]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(le,{className:"h-3.5 w-3.5 mr-1.5 text-blue-500"}),e.jsxs("span",{children:["Target: ",s.targetValue]})]}),s.isUserCreated&&e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(P,{className:"h-3.5 w-3.5 mr-1.5 text-purple-500"}),e.jsx("span",{children:"User created"})]}),s.createdAt&&e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(ie,{className:"h-3.5 w-3.5 mr-1.5 text-gray-500"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]}),r&&s.tags&&e.jsx("div",{className:"flex flex-wrap gap-1 pt-1",children:S(s.tags).map((t,i)=>e.jsxs(y,{variant:"outline",className:"text-xs bg-gray-50",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),t]},i))})]})}),e.jsx(ne,{children:l?e.jsxs(g,{disabled:!0,className:"w-full bg-green-500 hover:bg-green-600",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Completed"]}):N?e.jsx(g,{onClick:()=>m.mutate(),disabled:m.isPending,className:"w-full",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Record Progress"]})}):e.jsxs(g,{disabled:!0,className:"w-full",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Sign in to track progress"]})})]})}const pe=["All Categories","Mindfulness","Physical Activity","Sleep","Nutrition","Social Connection","Gratitude","Stress Reduction","Creativity","Learning","Productivity","Personal Growth","Environmental","Financial Wellbeing","Work-Life Balance","Emotional Intelligence"],fe=["All Difficulties","Easy","Moderate","Hard","Extreme"];function be(){const{user:s}=K();H(),z();const[d,N]=x.useState("browse"),[n,j]=x.useState(""),[r,w]=x.useState("All Categories"),[o,l]=x.useState("All Difficulties"),{data:m=[],isLoading:v,error:b}=U({queryKey:["/api/challenges/my-created"],enabled:(s==null?void 0:s.isPremium)===!0}),{data:S=[],isLoading:t,error:i}=U({queryKey:["/api/challenges/public"]}),A=(a,C,T,E)=>a.filter(c=>{const $=C===""||c.title.toLowerCase().includes(C.toLowerCase())||c.description.toLowerCase().includes(C.toLowerCase())||c.tags&&c.tags.toLowerCase().includes(C.toLowerCase()),G=T==="All Categories"||c.category.toLowerCase()===T.toLowerCase(),O=E==="All Difficulties"||c.difficulty.toLowerCase()===E.toLowerCase();return $&&G&&O}),p=A(S,n,r,o),f=A(m,n,r,o);return e.jsxs("div",{className:"container max-w-6xl py-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Community Challenges"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Create and participate in wellness challenges created by the community"})]}),e.jsx(de,{}),e.jsxs(oe,{defaultValue:d,onValueChange:N,className:"w-full",children:[e.jsxs(me,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(F,{value:"browse",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Browse Challenges"]}),(s==null?void 0:s.isPremium)&&e.jsxs(F,{value:"my-challenges",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"My Challenges"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 my-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(he,{placeholder:"Search challenges...",value:n,onChange:a=>j(a.target.value),className:"w-full"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(V,{value:r,onValueChange:w,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(B,{placeholder:"Category"})}),e.jsx(M,{children:pe.map(a=>e.jsx(Q,{value:a,children:a},a))})]}),e.jsxs(V,{value:o,onValueChange:l,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(B,{placeholder:"Difficulty"})}),e.jsx(M,{children:fe.map(a=>e.jsx(Q,{value:a,children:a},a))})]})]})]}),e.jsxs(R,{value:"browse",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(Y,{})}),t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):i?e.jsx(h,{children:e.jsx(u,{className:"py-8 text-center",children:e.jsx("p",{className:"text-red-500",children:"Error loading challenges. Please try again later."})})}):p.length===0?e.jsx(h,{children:e.jsx(u,{className:"py-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No challenges match your filters. Try adjusting your search criteria."})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Community-Created Challenges"}),e.jsxs(y,{variant:"outline",className:"text-xs bg-primary/10",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),p.length," ",p.length===1?"Challenge":"Challenges"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(a=>e.jsx(q,{challenge:a,userProgress:0},a.id))})]})]}),(s==null?void 0:s.isPremium)&&e.jsxs(R,{value:"my-challenges",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(Y,{})}),v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):b?e.jsx(h,{children:e.jsx(u,{className:"py-8 text-center",children:e.jsx("p",{className:"text-red-500",children:"Error loading your challenges. Please try again later."})})}):f.length===0?e.jsx(h,{children:e.jsxs(u,{className:"py-12 text-center",children:[e.jsx(k,{className:"h-12 w-12 text-primary mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Challenges Created Yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-6 max-w-md mx-auto",children:"You haven't created any challenges yet. Create your first challenge to earn tokens when others complete it!"}),e.jsxs(g,{onClick:()=>{var a;return(a=document.querySelector("form"))==null?void 0:a.scrollIntoView({behavior:"smooth"})},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Create Your First Challenge"]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Your Created Challenges"}),e.jsxs(y,{variant:"outline",className:"text-xs bg-primary/10",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),f.length," ",f.length===1?"Challenge":"Challenges"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(a=>e.jsx(q,{challenge:a,userProgress:0},a.id))})]})]})]})]})}export{be as default};
