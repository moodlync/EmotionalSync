import{aS as v,a as y,r as d,Y as k,j as e,k as C,C as m,d as h,e as x,f as u,a0 as f,B as j,A as S,h as b,i as M,o as P,ce as R,aa as T,g as U,ac as A,Q as I,aV as L,ap as $,V as F}from"./index-FJB1i4HR.js";function E(){v(),y();const[l,p]=d.useState(!1),i=new URLSearchParams(window.location.search),n=i.get("user"),c=i.get("milestone"),r=i.get("trackingId"),{data:s,isLoading:N,error:w}=k({queryKey:["/api/milestone-share",n,c,r],queryFn:async()=>{const a=new URLSearchParams;n&&a.set("username",n),c&&a.set("milestone",c),r&&a.set("trackingId",r);const t=await fetch(`/api/milestone-share?${a.toString()}`);if(!t.ok)throw new Error("Failed to load milestone data");return t.json()},enabled:!!n&&!!c});d.useEffect(()=>{s&&(async()=>{if(r&&(s!=null&&s.sharerUserId)&&!l)try{await F("POST","/api/milestone-share/click",{trackingId:r,sharerUserId:s.sharerUserId}),p(!0)}catch(t){console.error("Failed to record click:",t)}})()},[s,r,l]);const o=s?Math.min(100,Math.round((s.currentTokens||0)/(s.milestone||1)*100)):0,g=()=>{window.location.href=`/auth?referral=${encodeURIComponent(n||"")}`};return N?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading milestone information..."})]}):w||!s?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{className:"text-destructive",children:"Milestone Not Found"}),e.jsx(u,{children:"Sorry, the milestone you're looking for could not be found or has expired."})]}),e.jsx(f,{children:e.jsx(j,{variant:"default",className:"w-full",onClick:()=>window.location.href="/",children:"Go to MoodSync Home"})})]})})}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 bg-gradient-to-b from-background to-muted/30",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(m,{className:"border-2 shadow-lg",children:[e.jsxs(h,{className:"pb-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-10 w-10 border",children:s.user.avatar?e.jsx(b,{src:s.user.avatar,alt:s.user.username}):e.jsx(M,{children:s.user.username.slice(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:s.user.username}),e.jsxs(P,{variant:"secondary",className:"ml-2 text-xs",children:["Level ",s.user.level]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["MoodSync user since ",R(new Date(s.user.createdAt),{addSuffix:!0})]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(x,{className:"text-xl",children:s.achieved?e.jsxs("span",{className:"flex items-center text-amber-600 dark:text-amber-400",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Achievement Unlocked!"]}):e.jsx("span",{children:"Working Toward a Milestone"})}),e.jsx(u,{className:"mt-1",children:s.achieved?`${s.user.username} has reached the ${s.milestone} tokens milestone on MoodSync!`:`${s.user.username} is working toward the ${s.milestone} tokens milestone on MoodSync.`})]})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-md bg-muted/30 border space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Token Progress"}),e.jsxs("span",{className:"font-medium",children:[s.currentTokens," / ",s.milestone]})]}),e.jsx(A,{value:o,className:"h-2"}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.achieved?"Milestone achieved! ðŸŽ‰":`${o}% complete`})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"What is MoodSync?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MoodSync is an emotional wellness platform that helps you track, understand, and improve your emotional well-being through:"}),e.jsx("div",{className:"space-y-1.5 mt-2",children:["Real-time emotional connections with others","Mood tracking and emotional insights","Token rewards for emotional wellness activities","Premium features for enhanced emotional health"].map((a,t)=>e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-green-500 mt-0.5"}),e.jsx("span",{children:a})]},t))})]})]}),e.jsxs(f,{className:"flex flex-col space-y-3",children:[e.jsxs(j,{className:"w-full flex items-center justify-center",onClick:g,children:["Join MoodSync Now",e.jsx(L,{className:"h-4 w-4 ml-2"})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground flex items-center justify-center",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Safe, secure, and privacy-focused platform"]})]})]})})})}export{E as default};
